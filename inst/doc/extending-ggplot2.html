<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Extending ggplot2</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Extending ggplot2</h1>



<p>This vignette documents the official extension mechanism provided in
ggplot2 2.0.0. This vignette is a high-level adjunct to the low-level
details found in <code>?Stat</code>, <code>?Geom</code> and
<code>?theme</code>. You’ll learn how to extend ggplot2 by creating a
new stat, geom, or theme.</p>
<p>As you read this document, you’ll see many things that will make you
scratch your head and wonder why on earth is it designed this way?
Mostly it’s historical accident - I wasn’t a terribly good R programmer
when I started writing ggplot2 and I made a lot of questionable
decisions. We cleaned up as many of those issues as possible in the
2.0.0 release, but some fixes simply weren’t worth the effort.</p>
<div id="ggproto" class="section level2">
<h2>ggproto</h2>
<p>All ggplot2 objects are built using the ggproto system of object
oriented programming. This OO system is used only in one place: ggplot2.
This is mostly historical accident: ggplot2 started off using <a href="https://cran.r-project.org/package=proto">proto</a> because I
needed mutable objects. This was well before the creation of (the
briefly lived) <a href="http://vita.had.co.nz/papers/mutatr.html">mutatr</a>, reference
classes and R6: proto was the only game in town.</p>
<p>But why ggproto? Well when we turned to add an official extension
mechanism to ggplot2, we found a major problem that caused problems when
proto objects were extended in a different package (methods were
evaluated in ggplot2, not the package where the extension was added). We
tried converting to R6, but it was a poor fit for the needs of ggplot2.
We could’ve modified proto, but that would’ve first involved
understanding exactly how proto worked, and secondly making sure that
the changes didn’t affect other users of proto.</p>
<p>It’s strange to say, but this is a case where inventing a new OO
system was actually the right answer to the problem! Fortunately Winston
is now very good at creating OO systems, so it only took him a day to
come up with ggproto: it maintains all the features of proto that
ggplot2 needs, while allowing cross package inheritance to work.</p>
<p>Here’s a quick demo of ggproto in action:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;A&quot;</span>, <span class="cn">NULL</span>,</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>  <span class="at">x =</span> <span class="dv">1</span>,</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="at">inc =</span> <span class="cf">function</span>(self) {</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>    self<span class="sc">$</span>x <span class="ot">&lt;-</span> self<span class="sc">$</span>x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  }</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>A<span class="sc">$</span>x</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>A<span class="sc">$</span><span class="fu">inc</span>()</span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>A<span class="sc">$</span>x</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#&gt; [1] 2</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a>A<span class="sc">$</span><span class="fu">inc</span>()</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>A<span class="sc">$</span><span class="fu">inc</span>()</span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>A<span class="sc">$</span>x</span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co">#&gt; [1] 4</span></span></code></pre></div>
<p>The majority of ggplot2 classes are immutable and static: the methods
neither use nor modify state in the class. They’re mostly used as a
convenient way of bundling related methods together.</p>
<p>To create a new geom or stat, you will just create a new ggproto that
inherits from <code>Stat</code>, <code>Geom</code> and override the
methods described below.</p>
</div>
<div id="creating-a-new-stat" class="section level2">
<h2>Creating a new stat</h2>
<div id="the-simplest-stat" class="section level3">
<h3>The simplest stat</h3>
<p>We’ll start by creating a very simple stat: one that gives the convex
hull (the <em>c</em> hull) of a set of points. First we create a new
ggproto object that inherits from <code>Stat</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>StatChull <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;StatChull&quot;</span>, Stat,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>  <span class="at">compute_group =</span> <span class="cf">function</span>(data, scales) {</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>    data[<span class="fu">chull</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  },</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>  </span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>)</span></code></pre></div>
<p>The two most important components are the
<code>compute_group()</code> method (which does the computation), and
the <code>required_aes</code> field, which lists which aesthetics must
be present in order for the stat to work.</p>
<p>Next we write a layer function. Unfortunately, due to an early design
mistake I called these either <code>stat_()</code> or
<code>geom_()</code>. A better decision would have been to call them
<code>layer_()</code> functions: that’s a more accurate description
because every layer involves a stat <em>and</em> a geom.</p>
<p>All layer functions follow the same form - you specify defaults in
the function arguments and then call the <code>layer()</code> function,
sending <code>...</code> into the <code>params</code> argument. The
arguments in <code>...</code> will either be arguments for the geom (if
you’re making a stat wrapper), arguments for the stat (if you’re making
a geom wrapper), or aesthetics to be set. <code>layer()</code> takes
care of teasing the different parameters apart and making sure they’re
stored in the right place:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>stat_chull <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>,</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>                       <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>                       <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>    <span class="at">stat =</span> StatChull, <span class="at">data =</span> data, <span class="at">mapping =</span> mapping, <span class="at">geom =</span> geom, </span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>  )</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>}</span></code></pre></div>
<p>(Note that if you’re writing this in your own package, you’ll either
need to call <code>ggplot2::layer()</code> explicitly, or import the
<code>layer()</code> function into your package namespace.)</p>
<p>Once we have a layer function we can try our new stat:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>  <span class="fu">stat_chull</span>(<span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. The convex hull of all the points is marked by a polygon with no fill." style="display: block; margin: auto;" /></p>
<p>(We’ll see later how to change the defaults of the geom so that you
don’t need to specify <code>fill = NA</code> every time.)</p>
<p>Once we’ve written this basic object, ggplot2 gives a lot for free.
For example, ggplot2 automatically preserves aesthetics that are
constant within each group:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy, <span class="at">colour =</span> drv)) <span class="sc">+</span> </span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="fu">stat_chull</span>(<span class="at">fill =</span> <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. The convex hulls of points, grouped and coloured by three types of drive train, are marked by polygons with no fill but the outline matches the colours of the points." style="display: block; margin: auto;" /></p>
<p>We can also override the default geom to display the convex hull in a
different way:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">stat_chull</span>(<span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. The points that are part of the convex hull of all points are marked with a red outline." style="display: block; margin: auto;" /></p>
</div>
<div id="stat-parameters" class="section level3">
<h3>Stat parameters</h3>
<p>A more complex stat will do some computation. Let’s implement a
simple version of <code>geom_smooth()</code> that adds a line of best
fit to a plot. We create a <code>StatLm</code> that inherits from
<code>Stat</code> and a layer function, <code>stat_lm()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>StatLm <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;StatLm&quot;</span>, Stat, </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>  <span class="at">compute_group =</span> <span class="cf">function</span>(data, scales) {</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> <span class="fu">range</span>(data<span class="sc">$</span>x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> rng)</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    </span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    grid<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> grid)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>    </span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>    grid</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>stat_lm <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>                    <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>                    <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>    <span class="at">stat =</span> StatLm, <span class="at">data =</span> data, <span class="at">mapping =</span> mapping, <span class="at">geom =</span> geom, </span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>  )</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>}</span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>  <span class="fu">stat_lm</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. A straight line with a negative slope passes through the cloud of points." style="display: block; margin: auto;" /></p>
<p><code>StatLm</code> is inflexible because it has no parameters. We
might want to allow the user to control the model formula and the number
of points used to generate the grid. To do so, we add arguments to the
<code>compute_group()</code> method and our wrapper function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>StatLm <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;StatLm&quot;</span>, Stat, </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  </span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>  <span class="at">compute_group =</span> <span class="cf">function</span>(data, scales, params, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">formula =</span> y <span class="sc">~</span> x) {</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> <span class="fu">range</span>(data<span class="sc">$</span>x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>    grid <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">seq</span>(rng[<span class="dv">1</span>], rng[<span class="dv">2</span>], <span class="at">length =</span> n))</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>    </span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>    mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(formula, <span class="at">data =</span> data)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>    grid<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newdata =</span> grid)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>    </span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>    grid</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  }</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>stat_lm <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                    <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>                    <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, <span class="at">n =</span> <span class="dv">50</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, </span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>                    ...) {</span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>    <span class="at">stat =</span> StatLm, <span class="at">data =</span> data, <span class="at">mapping =</span> mapping, <span class="at">geom =</span> geom, </span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">n =</span> n, <span class="at">formula =</span> formula, <span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>  )</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>}</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>  <span class="fu">stat_lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  <span class="fu">stat_lm</span>(<span class="at">formula =</span> y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">10</span>), <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">n =</span> <span class="dv">20</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. A wobbly line follows the point cloud over the horizontal direction. 20 points are placed on top of the line with constant horizontal intervals." style="display: block; margin: auto;" /></p>
<p>Note that we don’t <em>have</em> to explicitly include the new
parameters in the arguments for the layer, <code>...</code> will get
passed to the right place anyway. But you’ll need to document them
somewhere so the user knows about them. Here’s a brief example. Note
<code>@inheritParams ggplot2::stat_identity</code>: that will
automatically inherit documentation for all the parameters also defined
for <code>stat_identity()</code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co">#&#39; @export</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&#39; @inheritParams ggplot2::stat_identity</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&#39; @param formula The modelling formula passed to \code{lm}. Should only </span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&#39;   involve \code{y} and \code{x}</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&#39; @param n Number of points used for interpolation.</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>stat_lm <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>                    <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>                    <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, <span class="at">n =</span> <span class="dv">50</span>, <span class="at">formula =</span> y <span class="sc">~</span> x, </span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>                    ...) {</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a>    <span class="at">stat =</span> StatLm, <span class="at">data =</span> data, <span class="at">mapping =</span> mapping, <span class="at">geom =</span> geom, </span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">n =</span> n, <span class="at">formula =</span> formula, <span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>  )</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>}</span></code></pre></div>
<p><code>stat_lm()</code> must be exported if you want other people to
use it. You could also consider exporting <code>StatLm</code> if you
want people to extend the underlying object; this should be done with
care.</p>
</div>
<div id="picking-defaults" class="section level3">
<h3>Picking defaults</h3>
<p>Sometimes you have calculations that should be performed once for the
complete dataset, not once for each group. This is useful for picking
sensible default values. For example, if we want to do a density
estimate, it’s reasonable to pick one bandwidth for the whole plot. The
following Stat creates a variation of the <code>stat_density()</code>
that picks one bandwidth for all groups by choosing the mean of the
“best” bandwidth for each group (I have no theoretical justification for
this, but it doesn’t seem unreasonable).</p>
<p>To do this we override the <code>setup_params()</code> method. It’s
passed the data and a list of params, and returns an updated list.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>StatDensityCommon <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;StatDensityCommon&quot;</span>, Stat, </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>  </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">setup_params =</span> <span class="cf">function</span>(data, params) {</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(params<span class="sc">$</span>bandwidth))</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>      <span class="fu">return</span>(params)</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>    </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>    xs <span class="ot">&lt;-</span> <span class="fu">split</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>group)</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>    bws <span class="ot">&lt;-</span> <span class="fu">vapply</span>(xs, bw.nrd0, <span class="fu">numeric</span>(<span class="dv">1</span>))</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>    bw <span class="ot">&lt;-</span> <span class="fu">mean</span>(bws)</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Picking bandwidth of &quot;</span>, <span class="fu">signif</span>(bw, <span class="dv">3</span>))</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>    </span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>    params<span class="sc">$</span>bandwidth <span class="ot">&lt;-</span> bw</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>    params</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>  },</span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>  </span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>  <span class="at">compute_group =</span> <span class="cf">function</span>(data, scales, <span class="at">bandwidth =</span> <span class="dv">1</span>) {</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">density</span>(data<span class="sc">$</span>x, <span class="at">bw =</span> bandwidth)</span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">x =</span> d<span class="sc">$</span>x, <span class="at">y =</span> d<span class="sc">$</span>y)</span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>  }  </span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>)</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>stat_density_common <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a>                                <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>                                <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, <span class="at">bandwidth =</span> <span class="cn">NULL</span>,</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>                                ...) {</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>    <span class="at">stat =</span> StatDensityCommon, <span class="at">data =</span> data, <span class="at">mapping =</span> mapping, <span class="at">geom =</span> geom, </span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">bandwidth =</span> bandwidth, <span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>  )</span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>}</span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, <span class="at">colour =</span> drv)) <span class="sc">+</span> </span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>  <span class="fu">stat_density_common</span>()</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt; Picking bandwidth of 0.345</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="A line plot showing three kernel density estimates of engine displacement, coloured for three types of drive trains. The lines are a little bit wobbly." style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, <span class="at">colour =</span> drv)) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">stat_density_common</span>(<span class="at">bandwidth =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="A line plot showing three kernel density estimates of engine displacement, coloured for three types of drive trains. The lines are fairly smooth." style="display: block; margin: auto;" /></p>
<p>I recommend using <code>NULL</code> as a default value. If you pick
important parameters automatically, it’s a good idea to
<code>message()</code> to the user (and when printing a floating point
parameter, using <code>signif()</code> to show only a few significant
digits).</p>
</div>
<div id="variable-names-and-default-aesthetics" class="section level3">
<h3>Variable names and default aesthetics</h3>
<p>This stat illustrates another important point. If we want to make
this stat usable with other geoms, we should return a variable called
<code>density</code> instead of <code>y</code>. Then we can set up the
<code>default_aes</code> to automatically map <code>density</code> to
<code>y</code>, which allows the user to override it to use with
different geoms:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>StatDensityCommon <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;StatDensity2&quot;</span>, Stat, </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>  <span class="at">default_aes =</span> <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">stat</span>(density)),</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>  <span class="at">compute_group =</span> <span class="cf">function</span>(data, scales, <span class="at">bandwidth =</span> <span class="dv">1</span>) {</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">density</span>(data<span class="sc">$</span>x, <span class="at">bw =</span> bandwidth)</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">x =</span> d<span class="sc">$</span>x, <span class="at">density =</span> d<span class="sc">$</span>y)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>  }  </span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>)</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, drv, <span class="at">colour =</span> <span class="fu">stat</span>(density))) <span class="sc">+</span> </span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>  <span class="fu">stat_density_common</span>(<span class="at">bandwidth =</span> <span class="dv">1</span>, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>)</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a><span class="co">#&gt; Warning: `stat(density)` was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt; ℹ Please use `after_stat(density)` instead.</span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt; This warning is displayed once every 8 hours.</span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt; Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; generated.</span></span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="A plot showing the engine displacement versus three types of drive trains. Every drive train is represented by a series of densely packed points that imitate a horizontal line, and their colour intensity indicates the kernel density estimate of the displacement." style="display: block; margin: auto;" /></p>
<p>However, using this stat with the area geom doesn’t work quite right.
The areas don’t stack on top of each other:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, <span class="at">fill =</span> drv)) <span class="sc">+</span> </span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">stat_density_common</span>(<span class="at">bandwidth =</span> <span class="dv">1</span>, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="An area plot showing the kernel density estimates of engine displacement. Three areas are shown that indicate the estimates for three types of drive trains separately. All areas are floored to the x-axis and overlap one another." style="display: block; margin: auto;" /></p>
<p>This is because each density is computed independently, and the
estimated <code>x</code>s don’t line up. We can resolve that issue by
computing the range of the data once in <code>setup_params()</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>StatDensityCommon <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;StatDensityCommon&quot;</span>, Stat, </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="st">&quot;x&quot;</span>,</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="at">default_aes =</span> <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">stat</span>(density)),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>  <span class="at">setup_params =</span> <span class="cf">function</span>(data, params) {</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>    min <span class="ot">&lt;-</span> <span class="fu">min</span>(data<span class="sc">$</span>x) <span class="sc">-</span> <span class="dv">3</span> <span class="sc">*</span> params<span class="sc">$</span>bandwidth</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>    max <span class="ot">&lt;-</span> <span class="fu">max</span>(data<span class="sc">$</span>x) <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> params<span class="sc">$</span>bandwidth</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>    </span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>    <span class="fu">list</span>(</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>      <span class="at">bandwidth =</span> params<span class="sc">$</span>bandwidth,</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>      <span class="at">min =</span> min,</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>      <span class="at">max =</span> max,</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>      <span class="at">na.rm =</span> params<span class="sc">$</span>na.rm</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>    )</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>  },</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>  </span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>  <span class="at">compute_group =</span> <span class="cf">function</span>(data, scales, min, max, <span class="at">bandwidth =</span> <span class="dv">1</span>) {</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>    d <span class="ot">&lt;-</span> <span class="fu">density</span>(data<span class="sc">$</span>x, <span class="at">bw =</span> bandwidth, <span class="at">from =</span> min, <span class="at">to =</span> max)</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">x =</span> d<span class="sc">$</span>x, <span class="at">density =</span> d<span class="sc">$</span>y)</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>  }  </span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a>)</span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, <span class="at">fill =</span> drv)) <span class="sc">+</span> </span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>  <span class="fu">stat_density_common</span>(<span class="at">bandwidth =</span> <span class="dv">1</span>, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">position =</span> <span class="st">&quot;stack&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="A stacked area plot showing kernel density estimates of engine displacement. Three areas are shown that indicate the estimates for three types of drive trains separately. The areas are stacked on top of one another and show no overlap." style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, drv, <span class="at">fill =</span> <span class="fu">stat</span>(density))) <span class="sc">+</span> </span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">stat_density_common</span>(<span class="at">bandwidth =</span> <span class="dv">1</span>, <span class="at">geom =</span> <span class="st">&quot;raster&quot;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAKgCAIAAADLXliSAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAcx0lEQVR4nO3dwW+bZ57Y8eehfegfIKBoPQESgPIuDB8NBCthgM1RCmJ4WkPdTovsTUIuS+WQKdr4mHTRDDART4F0m6AdbLXeriEg0qGHLDCVZgz4VsPYtQjYgKP24ntboOGzB/IlKYmUKYkcST9/PhHsl8/78uXrV4y+el++lHIpJQEAsdQuegMAgMkTeAAISOABICCBB4CABB4AAhJ4AAjo+oU86uvXr6e6/pmZmWk/xPld/o28/FuYrsJGXv4tTFdhIy//FiYbOSGT3cKZmZlJrerKcQQPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQ0PWL3oDz+uM//bOL3oSrKw+dHL3csYXykKmBgZyOPMaR5XNKKXfHun/n7n+D98459+9eLZB7s3rjuVpfzjl3l+8u0BvJOef+MjnnWq2arnVHDk3XDo8MjtdyrbdA989cqx2bW8udR8m1nGu5llOu5WvXc2exWi331lyrHb1jbXBW59FrnW0+9LjVgx7f8t4/PNeuHf6H9/ZYb/r10U/E0E9sOfRXKqWklEpJqVT/VdOllNJOpaTSLqV7e2C6PfhnKSW12/2b7XZnyWqiGmm3u6ttHxlsdwbbP/7YGzk8q/SW6W7G0Yc7tknt41tbjaSBwfbgSPeff3gidSc6ywzZXZ2R7sxUDVZLdkZ6C1U7v/Q+E2XY5+X4UP8uxz+dQ28NWcNQI+51Tn//d381kfW85RzBA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAEJPAAEJPAAEJDAA0BAAg8AAQk8AAQk8AAQkMADQEACDwABCTwABCTwABCQwANAQAIPAAFdn8paDx42vnr1bvr++xcffL716ftTeQwAYKTpBD6l9OL79PnW1kDb79y505t+8uTJtB4XgCtuZmbmojchgqkFPn0wd/jIfTDqr1+/ntrjAnC1TbARb/P3Cl6DB4CABB4AAhJ4AAhI4AEgoOlcZHfjfnNrKisGAMbhCB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASAggQeAgAQeAAISeAAISOABICCBB4CABB4AAhJ4AAhI4AEgIIEHgIAEHgACEngACEjgASCg6xe9AZOVh06OXi4PHR02ntPgvfLAYrm63V8kDwx2/8z9O+bqVu5O9wdzyp2R3qycOn/VainnnGu9Barpw3/Wcs61nHPKtVyr9cZzrTYw0p3oDx65mWu5di3Xavna9d7Nw0teS9Vdjq3nWrUNRx60s3m1PHzLc3+Bwb2Uj+/PUZ/akkr1V0mpe6OUUqqxkkrpjpRSUrszXdo/plJKaadSSrvdny7t3s3SbqfSLqVd2qWaaKfSLu32kLntExboDv74//7PsTUfeaxSSju126WUoTcHt7P6R/XGq+k08O/tL1Y6+6U/MXRHpVQt0Nmp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" alt="A heatmap showing the density of engine displacement for three types of drive trains. The heatmap has three rows for the drive trains, but are continuous in the horizontal direction. The fill intensity of the heatmap shows the kernel density estimates." style="display: block; margin: auto;" /></p>
</div>
<div id="exercises" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Extend <code>stat_chull</code> to compute the alpha hull, as from
the <a href="https://cran.r-project.org/package=alphahull">alphahull</a>
package. Your new stat should take an <code>alpha</code>
argument.</p></li>
<li><p>Modify the final version of <code>StatDensityCommon</code> to
allow the user to specify the <code>min</code> and <code>max</code>
parameters. You’ll need to modify both the layer function and the
<code>compute_group()</code> method.</p>
<p>Note: be careful when adding parameters to a layer function. The
following names <em>col</em>, <em>color</em>, <em>pch</em>,
<em>cex</em>, <em>lty</em>, <em>lwd</em>, <em>srt</em>, <em>adj</em>,
<em>bg</em>, <em>fg</em>, <em>min</em>, and <em>max</em> are
intentionally renamed to accomodate base graphical parameter names. For
example, a value passed as <em>min</em> to a layer appears as
<em>ymin</em> in the <code>setup_params</code> list of params. It is
recommended you avoid using these names for layer parameters.</p></li>
<li><p>Compare and contrast <code>StatLm</code> to
<code>ggplot2::StatSmooth</code>. What key differences make
<code>StatSmooth</code> more complex than <code>StatLm</code>?</p></li>
</ol>
</div>
</div>
<div id="creating-a-new-geom" class="section level2">
<h2>Creating a new geom</h2>
<p>It’s harder to create a new geom than a new stat because you also
need to know some grid. ggplot2 is built on top of grid, so you’ll need
to know the basics of drawing with grid. If you’re serious about adding
a new geom, I’d recommend buying <a href="https://www.amazon.com/dp/B00I60M26G/ref=cm_sw_su_dp">R
graphics</a> by Paul Murrell. It tells you everything you need to know
about drawing with grid.</p>
<div id="a-simple-geom" class="section level3">
<h3>A simple geom</h3>
<p>It’s easiest to start with a simple example. The code below is a
simplified version of <code>geom_point()</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>GeomSimplePoint <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;GeomSimplePoint&quot;</span>, Geom,</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="at">default_aes =</span> <span class="fu">aes</span>(<span class="at">shape =</span> <span class="dv">19</span>, <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="at">draw_key =</span> draw_key_point,</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="at">draw_panel =</span> <span class="cf">function</span>(data, panel_params, coord) {</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>    coords <span class="ot">&lt;-</span> coord<span class="sc">$</span><span class="fu">transform</span>(data, panel_params)</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">pointsGrob</span>(</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>      coords<span class="sc">$</span>x, coords<span class="sc">$</span>y,</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>      <span class="at">pch =</span> coords<span class="sc">$</span>shape,</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>      <span class="at">gp =</span> grid<span class="sc">::</span><span class="fu">gpar</span>(<span class="at">col =</span> coords<span class="sc">$</span>colour)</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a>    )</span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>  }</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>geom_simple_point <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>                              <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>                              <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>    <span class="at">geom =</span> GeomSimplePoint, <span class="at">mapping =</span> mapping,  <span class="at">data =</span> data, <span class="at">stat =</span> stat, </span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>  )</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>}</span>
<span id="cb16-25"><a href="#cb16-25" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb16-27"><a href="#cb16-27" tabindex="-1"></a>  <span class="fu">geom_simple_point</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. The points are larger than the default." style="display: block; margin: auto;" /></p>
<p>This is very similar to defining a new stat. You always need to
provide fields/methods for the four pieces shown above:</p>
<ul>
<li><p><code>required_aes</code> is a character vector which lists all
the aesthetics that the user must provide.</p></li>
<li><p><code>default_aes</code> lists the aesthetics that have default
values.</p></li>
<li><p><code>draw_key</code> provides the function used to draw the key
in the legend. You can see a list of all the build in key functions in
<code>?draw_key</code></p></li>
<li><p><code>draw_panel()</code> is where the magic happens. This
function takes three arguments and returns a grid grob. It is called
once for each panel. It’s the most complicated part and is described in
more detail below.</p></li>
</ul>
<p><code>draw_panel()</code> has three arguments:</p>
<ul>
<li><p><code>data</code>: a data frame with one column for each
aesthetic.</p></li>
<li><p><code>panel_params</code>: a list of per-panel parameters
generated by the coord. You should consider this an opaque data
structure: don’t look inside it, just pass along to <code>coord</code>
methods.</p></li>
<li><p><code>coord</code>: an object describing the coordinate
system.</p></li>
</ul>
<p>You need to use <code>panel_params</code> and <code>coord</code>
together to transform the data
<code>coords &lt;- coord$transform(data, panel_params)</code>. This
creates a data frame where position variables are scaled to the range
0–1. You then take this data and call a grid grob function.
(Transforming for non-Cartesian coordinate systems is quite complex -
you’re best off transforming your data to the form accepted by an
existing ggplot2 geom and passing it.)</p>
</div>
<div id="collective-geoms" class="section level3">
<h3>Collective geoms</h3>
<p>Overriding <code>draw_panel()</code> is most appropriate if there is
one graphic element per row. In other cases, you want graphic element
per group. For example, take polygons: each row gives one vertex of a
polygon. In this case, you should instead override
<code>draw_group()</code>.</p>
<p>The following code makes a simplified version of
<code>GeomPolygon</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>GeomSimplePolygon <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;GeomPolygon&quot;</span>, Geom,</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>  <span class="at">required_aes =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>),</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  </span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>  <span class="at">default_aes =</span> <span class="fu">aes</span>(</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>    <span class="at">colour =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="st">&quot;grey20&quot;</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>    <span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">1</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>  ),</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="at">draw_key =</span> draw_key_polygon,</span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  <span class="at">draw_group =</span> <span class="cf">function</span>(data, panel_params, coord) {</span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>    <span class="cf">if</span> (n <span class="sc">&lt;=</span> <span class="dv">2</span>) <span class="fu">return</span>(grid<span class="sc">::</span><span class="fu">nullGrob</span>())</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>    coords <span class="ot">&lt;-</span> coord<span class="sc">$</span><span class="fu">transform</span>(data, panel_params)</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>    <span class="co"># A polygon can only have a single colour, fill, etc, so take from first row</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    first_row <span class="ot">&lt;-</span> coords[<span class="dv">1</span>, , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">polygonGrob</span>(</span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>      coords<span class="sc">$</span>x, coords<span class="sc">$</span>y, </span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a>      <span class="at">default.units =</span> <span class="st">&quot;native&quot;</span>,</span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a>      <span class="at">gp =</span> grid<span class="sc">::</span><span class="fu">gpar</span>(</span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a>        <span class="at">col =</span> first_row<span class="sc">$</span>colour,</span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a>        <span class="at">fill =</span> scales<span class="sc">::</span><span class="fu">alpha</span>(first_row<span class="sc">$</span>fill, first_row<span class="sc">$</span>alpha),</span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a>        <span class="at">lwd =</span> first_row<span class="sc">$</span>linewidth <span class="sc">*</span> .pt,</span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a>        <span class="at">lty =</span> first_row<span class="sc">$</span>linetype</span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a>      )</span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a>    )</span>
<span id="cb17-29"><a href="#cb17-29" tabindex="-1"></a>  }</span>
<span id="cb17-30"><a href="#cb17-30" tabindex="-1"></a>)</span>
<span id="cb17-31"><a href="#cb17-31" tabindex="-1"></a>geom_simple_polygon <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, <span class="at">stat =</span> <span class="st">&quot;chull&quot;</span>,</span>
<span id="cb17-32"><a href="#cb17-32" tabindex="-1"></a>                                <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb17-33"><a href="#cb17-33" tabindex="-1"></a>                                <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb17-34"><a href="#cb17-34" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb17-35"><a href="#cb17-35" tabindex="-1"></a>    <span class="at">geom =</span> GeomSimplePolygon, <span class="at">mapping =</span> mapping, <span class="at">data =</span> data, <span class="at">stat =</span> stat, </span>
<span id="cb17-36"><a href="#cb17-36" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb17-37"><a href="#cb17-37" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb17-38"><a href="#cb17-38" tabindex="-1"></a>  )</span>
<span id="cb17-39"><a href="#cb17-39" tabindex="-1"></a>}</span>
<span id="cb17-40"><a href="#cb17-40" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb17-42"><a href="#cb17-42" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb17-43"><a href="#cb17-43" tabindex="-1"></a>  <span class="fu">geom_simple_polygon</span>(<span class="fu">aes</span>(<span class="at">colour =</span> class), <span class="at">fill =</span> <span class="cn">NA</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAqAAAAKgCAMAAABz4j/3AAABCFBMVEUAAAAAADoAAGYAOmYAOpAAZrYAtusAwJQzMzM6AAA6ADo6AGY6OgA6OmY6OpA6kJA6kNtNTU1NTW5NTY5NbqtNjshTtABmAABmADpmAGZmOgBmOpBmZjpmZmZmtv9uTU1uTW5uTY5ubo5ubqtuq+SOTU2OTW6OTY6Obk2ObquOyP+QOgCQOjqQZgCQkDqQkGaQtpCQ27aQ2/+liv+rbk2rbm6rbo6rjk2r5OSr5P+2ZgC2Zjq225C2/7a2/9u2///EmgDIjk3I///bkDrb25Db/7bb/9vb///kq27k///r6+vy8vL4dm37Ydf/tmb/yI7/25D/29v/5Kv//7b//8j//9v//+T////eIGI2AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAgAElEQVR4nO2dDZ/cxpHeIUXcteREJu/k4elyoc9nyb5IyvnMkZMT4xzXos+kJhqK4Ru+/zcJGi8zaKC6uqq7C1MY1POzvFzss9Vv/+0GMP1S1SaTYlWXzoDJhMkANamWAWpSLQPUpFoGqEm1DFCTajEBPXiafBsW2SgQchVpK8ykDG9sGaAq0laYSRne2DJAVaStMJMyvLFlgKpIW2EmZXhjywBVkbbCTMrwxpYBqiJthZmU4Y0tA1RF2gozKcMbWwaoirQVZlKGN7YMUBVpK8ykDG9sGaAq0laYSRne2LKPOk2qZT2oirQVZlKGN7YMUBVpK8ykDG9sGaAq0laYSRne2DJAVaStMJMyvLFlgKpIW2EmZXhjywBVkbbCTMrwxpYBqiJthZmU4Y0tA1RF2gozKcMbWwaoirQVZlKGN7YMUBVpK8ykDG9sGaAq0laYSRne2DJAVaStMJMyvLFlgKpIW2EmZXhjywBVkbbCTMrwxpYBqiJthZmU4Y0tUUCrqmJW1jbaPsNogOJi1UFVDYQqrH9daSvMpAxvbMkCujdACxsNUFysOmgA3RugZY0GKC5eHTSAMitrG22fYTRAcTHrYH+351XWNto+w2iA4uLVwf7u0BGqsP51pa0wkzK8sWWAqkhbYSZleGNLHNDDnlNZ22j7DKMBiotXBw2gHaEK619X2gozKcMbW7KAHgzQwkYDFBevDjpAmy8K619X2gozKcMbW+KAtoQqrH9daSvMpAxvbC0C6GFPraxttH2G0QDFxaoD94x06Af5zNpawmiA+pd1aBlAazKhm2j7DKMBiotVByNAyX3oJto+w2iA4mLVQQ9oQ6gBWspogOJi1cEYUCqhm2j7DKMBiotVBwOghztnpBG6ibbPMBqguFh1YICuOZMyvLG1HKA0QjfR9hlGAxQXpw72hwHQ/h8UQjfR9hlGAxQXpw4M0FVnUoY3tpYBtCYTuom2zzAaoLg4dTAHlEDoJto+w2iA4uLUwekZyQAtZzRAcXHqYAzogUroJto+w2iA4uLUAQRolNBNtH2G0QDFxakDA3TVmZThjS05QEfPSM5IJHQTbZ9hNEBxMeogAGiE0E20fYbRAMXFqIMJoMQudBNtn2E0QHEx6iAEKE7oJto+w2iA4mLUQRBQlNBNtH2G0QDFxaiDKaA0QjfR9hlGAxQXow4M0HVnUoY3tsQA3R+mgJII3UTbZxgNUFz0OkABDRO6ibbPMBqguOh1YICKGA1QXPQ6AAClELqJts8wGqC46HUwfkYCAA0Ruom2zzAaoLjodWCAihgNUFz0OoAAJRC6ibbPMBqguOh1EAUUJnQTbZ9hNEBxkevAe0Y6G6Nd6CbaPsNogOIi1wEBUJDQTbR9htEAxUWuAwqgEKGbaPsMowGKi1wHAUCjXegm2j7DaIDiItcBCVCA0E20fYbRAMVFroMQoDFCN9H2GUYDFBe5DgxQGaMBiotcB0RAZ4Ruou0zjAYoLmoddGfMVVU1N+KEbqLtM4wGKC5qHbSAVtVAKALohNBNtH2G0QDFRa0DA1TIaIDiotbBvh/hAUBxQjfR9hlGAxQXtQ66ZyTwHnQGqEfoJto+w2iA4qLWgf8QPzFiXegm2j7DaIDiotYBC9AxoZto+wyjAYqLWgc8QEeEbqLtM4wGKC5iHXSvQYNGpAvdRNtnGA1QXMQ64AJ6JnQTbZ9hNEBxEesgAihC6CbaPsNogOIi1oEBKmU0QHER64AP6EDoJto+w2iA4iLWQQzQMKGbaPsMowGKi1gHBqiU0QDFRauDljUU0CChm2j7DKMBOtb7b7+q67dfPvjsh+EKrQ7SAG1/bRNtn2E0QMd68eCrFtIXvxyu0OrAABUzGqAjvf6nf/6qfvu77+vXv/6+v0SrAwKgIUI30fYZRgP0rPd//Lem93z9mx/qt7/9rvn+Z41oQffNf3cRD/jzPS2+aTtCAH3xhRvef/psANSJ9kc6fYin9qDNb26ic8owWg96UtN1vvd6UCdaHVAAhQk1QNWkvQx/UYUBffHA6YvUe9A0QOMHysfSTjcaoP5lHYq+Znr/7Rfcp/jZMxJsBAmtqYSuue0zjAboWInvQQ1QOaMBiotUtCxAqYP8mts+w2iA4iIVjQgoSGhNvQ1dc9tnGA1QXKSiGaByRgMUF6loVEAhQusDkdA1t32G0QDFRSpaLqAkQtfc9hlGAxQXqWgGqJzRAMVFKVqHFwVQgNB6FALVmts+w2iA4qIUrQCgBELX3PYZRgMUF6VoBqig0QDFRSna/BY0XFkzQgdnlNA1t32G0QDFRSlaEUCjhK657TOMBiguStE4gM4INUC1pC3DG1tqAY0Ruua2zzAaoLgoRSsEaITQNbd9htEAxUUoGvAQj1XWhFADVEvaMryxpRhQnNA1t32G0QDFRSgaE1DMiRG65rbPMBqguAhFKwgoRuia2z7DaIDiIhTNAJU0GqC4CEXjAop+KBomdM1tn2E0QHERilYU0DCha277DKMBiitetJ4oBqDoLk4G6KXSluGNLe2ABgldc9tnGA1QXPGilQY0ROia2z7DaIDiihcNugWNVdbIbYBqSVuGN7b0AxogdM1tn2E0QHHFi1YeUJjQNbd9htEAxRUvWgqgI7sBqiVtGd7YWgOgIKFrbvsMowGKK1o08CE+XlknP+wECF1z22cYDVBc0aIZoLJGAxRXtGgygAKErrntM4wGKK5o0RIBPf1CyDkjdM1tn2E0QHFFi2aAyhoNUFzRoqUCOvxG0DkldM1tn2E0QHFFiyYG6JTQNbd9htEAxRUtmhygE0LX3PYZRgMUV6xoA0R8QPtfMUC1pC3DG1srAtQndM1tn2E0QHHFiiYKqEfomts+w2iA4ooVDb4FpVXWXdRpgBqgEcWKJgvomNA1t32G0QDFFStaDqDtb0WcZ0LX3PYZRgMUV6xoBqiw0QDFFSuaNKBnQtfc9hlGAxRXpGg9PtVdlVRZdwTnQOia2z7DaIDiihSto6dqAK1wIywDVFHaMryxpQrQhtC4c88LqbHtM4wGKK5I0ZYAtE9kzW2fYTRAcUWKlnkPaoAqSluGN7ZEAE18ine/SHHuWSEVtn2G0QDFFSnaMoC2yay57TOMBiiuSNEMUGmjAYoLL9rpLXoyoNAR8oD26277DKMBigsv2mKANimtue0zjAYoLrxoBQCtqYSuue0zjAYoLrxoBqi40QDFhRdtQUDjB8onpL0CowGKCy9aCUCpd6E1lVCFbZ9hNEBx4UUzQMWNBigutGhnZHIAJRJaUwd5hW2fYTRAcaFFWxhQIqEK2z7DaIDiQotmgMobDVBcaNFOwCTPZuqcJELrA5FQhW2fYTRAcaFFG3hJnw/KBJREqMK2zzAaoLjQopUClESoASpslOGNrXUDSiFUYdtnGA1QXGjRSt2DMgAlEKqw7TOMBigurGgjVrKe4oHfDxoNUDGjDG9srR3QOKEK2z7DaIDiwop2GUCjhCps+wyjAYoLK1pBQAmEGqDCRhne2Fo/oDFCFbZ9htEAxYUVrSSgcUJHIXFCFbZ9htEAxYUVzQBdwGiA4sKKdjFAcUIVtn2G0QDFhRRtTEk+oFFCg2mjRnpIpUYDFBdStEsCihGqsO0zjAYoLqRohQGNEWqAChtleGPrSgBFCFXY9hlGAxQXUrTLAhomVGHbZxgNUFxI0UaE5M5m6oQTaoAKG2V4Y0sC0Oz5oJ14gAYJVdj2GUYDNFn7c0wHaH7Au+QMmK5HxXrQ8QhfpgfFu9B5yEAXqrBzyjBaD4orXLQxHmXuQbmABghV2PYZRgMUV7hoHh0lnuKBMLGQIKEK2z7DaIDiChfNAF3EaIDiChdNA6AgoQrbPsNogOIKF00CUIxQOCRAqMK2zzAaoLjCRTNAFzEaoLiCRfPJKAUoQmgg5JxQhW2fYTRAcQWLpgXQOaEK2z7DaIDiChbNAF3GaIDiChZNCNAwocGQU0IVtn2G0QDFFSyaHkCnhCps+wyjAYorWDQpQIOEIiH9vChs+wyjAYorWDQDdBmjAYorWDQPikKTRVolAOpnRmHbZxgNUFyhovl8Fppu1ylAKBpynB2FbZ9hNEBxhYpmgC5kNEBxhYqmDNBxfhS2fYbRAMUVKpr/XFLyHjREaCTkOUMK2z7DaIDiChVt8u6x4FO8AXqhtGV4Y2sFgMKExkKecqSw7TOMBiiuUNH0AXrKksK2zzAaoLhCRTNAFzIaoLgCRZtO0CgLKEhoPOS+SNrKjAYorkDRVALa50ph22cYDVBcgaIJAwoRaoAKG2V4Y+uaAe2ypbDtM4wGKK5A0ZQC2uZLYdtnGA1QXIGiSQMKEGqAChtleGPrugF1GVPY9hlGAxRXoGhqAW1yprDtM4wGKC64aLOVlMUBnRNqgAobZXhjqwSg1X4yeansbKZWqYAe9grbPsNogOKCilY1gHpAlp0P2iu5U44eKM8PaYAup+sHtCYTaoB6l1G9+uRxOnQcGaApIS9nNEBxgUVb4h50Riij/qmEGqDeZVSrAnSJp/gcQKmEGqDeZVjvvq6qex2grz6uqup+3X19dP5aVOsBdBLUABU2wgC8+/pe/ebhIweo+1I/+/Bp25m++vjR8DUfyrE2ASiRUAPUuwxqGNqbr//veff11c+fdpf6r2W1DUBphBqg3mVQLz/saXSgvmyG9A8e10/aQb8+fS2qFQHqRzVAhY0wACNA3zxs4Ox61DcPq/b68LWgNgIoiVAD1LsMajTEv/yoGeNfftB9396Qjr4W01YApRBqgHqXQbmHJPefA9R1oB9/8LjtVN33/dd8KMdaE6BeWANU2BggYPSaqbnn/OAPTY/Z34qevhbVZgAlEGqAepd1aFWAjuPy6z9KqAHqXdYhAzQn5PJGAxQXXLR1ABol1AD1LuuQyGSRdECrahoqFDil/iOEGqDeZR2SmG6XDmhVRQg1QA1QVFDRigK6o3ahSfWPE2qAepd1SBmgu2q3Qx15gOKEGqDeZVD/F1Y+iCHpugfduREeRTQTUJRQA9S7DOpHWPkghqTqKX7XOzFEh9AGqLARBuBHsAPdCKC7szOMaCagGKEGqHcZ1IYB7Zis/W8B3dFDgsYwoQaodxnUdgHdzZwBRA3QZYwwAJsFdICxhi5CsdPrP0ioAepdBrVVQE8o+k6wE72jhQynHSLUAPUug9oooGcOp04AUQN0ESMMwDYBHUE4d84QzQY0RKgB6l0GFQHULY0PrPlIXPSpAdAxgZBziuhdPGQkIkyoAepdBoUD+ubvHgcXfawXUA8/2OkjaoAuYYQBwAF96ZYdP2kXgbgFSv0iz7Zbbf/dXXj1X/6evvbz8oD63WPI6SF6FwkZjwgSaoB6lxMAdWp60TefP62fNaw+ue++tN3qz5+6HrS7wNp95OKATobvsHOEaD6gIKEGqHc5DdB3X99vkexQrR2r7p+fO0D7C6zB/tKATp+ASH2tAbqAMQ3QNw/v1+2g/sFjN8J3yzyfuBHfAdpd0AdocBby0CueDPh85VMnepdf/wChBqh3OQXQ8+j98qPnQ+/p9hprh/j+gjpAg/Pkd1NDdEZ9j2gBQAFCDVDvcgKgPZ9uzxH3X3PL2XxxPPZ7jJ0vrALQ3cwQBXRA9M4AlTamAPqsbcBH3ZjePsW7Eb65+p/+/tG7r9un+A8er6YH3c0NBEA7RAsAOs+1AepdTgBUQJe7B91BBgKf7ld3JQCdZdsA9S6Duk5AoToITPckVutuV6KhJvk2QL3LoDYDaGg6MrVa7/C1dbSIBihihAHYCqBBvMiA1pHln6SIfsYNUO8yqI0smguzRa7WO3xtHTGil3MD1LsMCuxAtS87ZgOKgMUBlIaoAZpmhAG4g5UPYkgXABSlil6td/FghIjjrBug3mVQd2AHelWA4kRxAY0jGok4yrsB6l0Gdf2A5uE0Mp7TwBE1QNOMMABXD2hsRGZU6yiRnJuGc+YNUO8yqGsHNPOO0TOOE0E60WjEU+4NUO8yqCsHNP7QzalWL5UgogZomhEG4LoBzX0pNDFOUgkgGo84ZN8A9S6D0gToTw8e/O33df32ywef/TBcg4tGBJTyXj0D0ACihIh7ftqXMl4PoMRJd2FAX//6+/rFL+v3337lvvSCizYFtLrz5yR1c5QQPs+TmFjVOiMUQtQATTPCVCgC1KmB9O3vvm9Z7QQXbQJo1QBaed+3+9KGq2g0DTQTUABRSsQ9P+0LGZUD2s1I7lYXv/vm91V1/2XzX/3m839ppy73+zo41x+I587igDZd5+vf/FC//e13zTc/awTb9pOYDlDv+0Y7LBNOhMzOBP7lYimFtI9bTE44oO++fuTWdHQrO9ojPT++V7er5T56/vLDp/0C5M71l/we9PWv/ua7+qfPBkCd4L+9eA+Kv0tP7UHBLnTaiZIi7vlpX8aouwfthm23Nq5h8d03j2v3n1so//BR+8+6Pi87LjLEN2See1AyoPN70F1knnziPWgAUB9RWsQ9O+3LGJUD+unzHr0GxzGgbqH8k0fDAuSTKxvQ+s9fJdyDzl8AidV/iNARosSIewN0cjkF0FAP+nftP88LkEsA2o/t77/9gv0UP+FmJ1f/QUDPiBqgacYUQN3dZQNefw86HuLvjRYgd64/ZfegLx48aO5B89+D7gTrHwF0tut9RHsD1L+cAOjkKX7Ug/7DaAFy53LLkPMAhQQXDQV0dHZHem0FjSihLaLkiHsD1LucAmhA/WZNKRIHlNWLlQaUtfwzfl73JO1LGA1QXHDREEB3vMriV2uMUNIHrJ0MUO8yKE2fxUOCixYGlPegwnGSASUv/zzUVEIN0GsBFDxcJqW2wsY4oNTln42TSKgBeiWAct9FcpwnY4zQ1khC1AD1LoMC+VzpsuMRFBcHlIRoTb0N3TCgO1j5IIYkB2js7A5WbWHGCKEnYxRR5yQRumVAwQ50jYDyJ2zwnHxAo4gaoN5lUKsEtNpP5oJUd5WHwmxTxekF5vaLfrXigPoR4wuUKYQaoKsCtGoA9bCqqjtv+tJsW9rpBd4GtrNqxQidRsQ60S4kgVADdO2A7mD+QhcWBBRD1AD1LoNaJ6CTMV5zD+oUQrQPGSfUAF0VoK4L9a8vew8aJXR+EUY0+MyHpb2w0QDFFSrapE0XfYqPPCbBESFEDVDvMigyoP18ZDf307vAlRigy70HPeCEhiLOET05Y4QaoOQe9AxoogoBOmnT7pOkhMpaEFDsGMYIoQZoANDRSmPXYb552M5P7s4+djPtm/ute8MZyAmAvnn4QWzaXrhoXpv2m8vyK2tRQKedqAHqXU4B9LzSeDhYrnrUn33cDvFuhn135HEKoO2iu4+eFwN0mcki4wTZEXeBGxGcUAM02IOeVnn0R3M2Q3w/W7kF9Nn98RnIfEDbRSXV/RRAvTZdDaDBKS0ooQYoCdAWySeP+rOP2xVznz4/n4GcBmiHaPAeASvaqE0XnA86STEh4g7MJUaoAcrpQd0PuiWd7d4NjN4TAvSZu42tn4QGeqxoAKALzKifppgScQcsTDFAswHt70H7s4+bC8/asblblJwE6Luv272dGuBDXShatHObLrgmaZZiUsTdfO0pQqgBSgO04ck9xT/pn+L/jxvcq/v9GcgJgL55GH38R4sGASq9qhNKMinibra9RJhQAzQAqIB8QKvYW1W8aKcmXW5d/Em5gM436DFAAV32o043xCNPSHUM0FObLrazyFn5gM4+WwoSaoBeCNBW6JYkkaKBgEruzTRSiFBO2hNEQ4QaoJcD9GWFDvOxovVNOt3djjxHKW020zjN4ESpeFIupIeoATrTxYf4yPN/tGhdm/qATicwh5U2H7TXHRQhGBH4QRdyjGiA0C0DeslVnW77xoiiRYMBje5ge3ZeHFAPUZjQDQN6C6sQjYCmn8Xn9qBdk84ArdDVap7z8oCOEDVAJ7oFh/jFAG3PYci5BwUBPUQO+Zg4aQLSHgilRYTvQQehhBqglwO00ZP0p3gn16TTJ+r28SOntkhG+Dk+se2HThQi1AC9EKDuGJsqdTbTSftLAQoTmtz2HaIGqKeLAvrmIcZmK0rRAoDSCFUEaI8oQKgBetEhHhOpaPuFzuqcqTSgHaJzQg3Qyw7xefegjfYwoKVPO54LIjSz7Xc7A3SkiwLqVpRERKuDEKCFz4ufSwDQJtMzQg3QOKDnVcaJ6417lX5R32napCdjlNDMagUILdD2weIkR0w2rgbQUvJ7UHFAo4TqBDS4/DM1YrJRN6D+suNXn/4PN7Pj1c//9OlzN4+5O+u4v5oCaHgiPRfQuwmhI2OEUJWANn9woeWfqRFTjcoB9ZYdv/r4frfW49+/edxw+R/dWcf9VTag7WK7qsxDUsOJTyj0GQ2rtsjGOaFF2n6ftqP55gCdrersvjy7X3frkfqzjhm3pRKvmXBACZvIUrQsoG154OWfqRHTjOsE9NWnf3ULOruzjnUA6hPqGzFCNQMKL/9MjZhmXCeg777510+fj8461gCoR+jEGN3lmKCQcUZoobbviwMs/0yNmGRcJ6D1s363plefPNYI6Gzi0HQCc/r+oLNfuCszm2muoTzz5Z9hGaDDl09OZx2rAfRMKLDDcmCPcPZ8UCD0XYH5oJDOf3D082m3BqiALgRoBe8RXlVHtYCOCSWf/kn0GaBBCQJ6alEWoMcjp1qXBPRM6Gz5J57JkkYDFBexDvonlRGh/s+na0DO96DH6kBDdPF7UA9Q8umfRBmgIS0CKGiEG7iFk4Lo0k/xTkN5OiPt9M9CSQuG3DCgkxadCGzfHs04ogu/B+20942k0z8LJS0XkgfoZVd1RkWsgxMme8wINe8JzBiiGgAlnf5ZKGm5kCxAwQ5U/XHcM9EAhQgdYYkjCocUmixy0n5mFP3gdpGQLEBvYOWDGJIwoECLjjVvXQ9KDNHLANqVxzPGT/8slLRUSB6gYAd6tYDOCT2i38bSFplR72kOaPz0z0JJS4XcNqBgi440bdspkcFO9EKAtuWZGSOnfxZKWijkxgGFW/SsSdPOeQwgCoUsv6oT0B404qd/FkpaJqQBileW37IQjSCiygDFT/8slLRMyK0DGmzRQV7Dwt0lgCgQsujWN2Htgy8lwqd/FkpaJOTmAQ23aK9xu4ZuOWeIXg7Qw578zLdRQE+z6dqDkfKkAdBxu4Yf2yeIzkMG9gAXaPvw8Qriyz9XAehJWgGt7vx5GHtgsoj3/W48WQSM6AxjRIcIo0gwoMG50NAMFjDCXNghX2WWf4bzMnGSjfS0h8ugcEDffP4vw6mH7WlIDaDvvv7oL90U5f6HCgCdTXnbz6fb+YZdZD7o8AvH6YVRpCCf8FxoaA4geS4qepJngeWfSF7qNCM97dPlFEAffvT8Zbsuzu2x8PKjv37z+Em/1qMBtPuhRkCrfQTQYYZ9DNBTJ3phQCOnIWcv/6yqH8nSBeijdoeG/iDZ5t//+X59BvRRwpi/DKDVfu8bZrDsaIAOiM4BDdyBXgTQ7OWfDaDkHvTHH0khyWmfLqcA6k7efvKoXWjstmZ49/Uv/uvzE6DdDxUAOrsHdS3vIQrcD3Ytit6D9moRnd2DBgAVuQetYwfKH3KXfzaA0pwu0zCilwLU70EfP7s/BlRHDxrYwDbSph2hpNn0DtFJ2iE+xR6Qo4SyTtibGQPdYiAkhOhlhvh7w8nbX7tF8P/+jXtOcmQ++/Bp/0O9gPqd6FwtocQVScejfkCbTnQpQCFEL9OD/sP0Kd5986yqfvH50/6HigGNIeoIJQI6fS0a5lPsFSOB0Izln1xA54he7B40JPSHQS0LaKRZdwxAaw/RCwBKITR9+Scf0CmiBmgSoHgnuuMAOqIZ4fPCgKYu/0wB1EdUwydJBbQ4oDiiOxagp070IoASCO2MKcs/0wAdI2qApgKKtiwP0B5RjE/Jj7mjhA5G/vLPVEDPv2mApgOKdKJH9mNFg6h6QPnLP9MBHTpRIUCvbdFcyBhC9Eg8kW4cMmX5Z5bzZIwROo7IW/6ZAWiPqAygYAe64mXHiBFu3GPCmYl3Ccs/s5zElxKTiKzln1mAtojKALqHlQ9iSJcDFO5EEwBtEwsjqgZQ1vLPTEDhD5dYEWEA9mAHep2Agog6zpiHevaJhRAVBTRC6CwieflnNqCHmoqoAYoYZ+3bUsZ6c3hOi778MxKSY0QJBSISl38WAJTai24Q0OlsJqRWJ51oP5tp1ojBqUdVNfpjgDrRgtsvwkaMUDBig2h8a1IqoJEZ9RREtwfodD4o3vT+NLx+PuiE0ODkzWlSM0SDszyBHywEqEN0mnYqoPEZ9XFCrwpQWszq7o4Rd/QM2ALa/ms3iVhVFXShBdSzHo/4b0Z/wBa/dSpHKG75kRgpXoofiaFo0g4o6W/PVdrdHcE46DTOj2bUT3dgDvSgd/MexOtF5XtQrA+FI7Yd6FI96CE6zsv1oOzp88DxHzL3oK7SxohGm/5E6HlGPbxH+PTC9GaiFbT8E86kp0UA3bmnpMXuQYdoGKIbBLTX3YnReNMPnegILcqHg6EPOUeICj/FOwUJnRp3S75m8uOFES0J6Mv2pNfhKKQn/60917idu+z+v/nR6DzkYRlydwhy6/rDw9lBsZKAHk7dKKVWO0THw3P8w0HkQ/gTogsAGiTUNyIfJYkDiiBaENA3nz+tn907A3pa/fHyo+dP2kOOR+ch98uQ33SHIHeuvyzag7ZqEaXVqmtm7yk8dqgnOklkCKUE0GDnCUcsD2gQ0ZKAdnOST4A+6td49uw2Px6dRTdahtwfgrz0EN+rGemJtdp0ov5rosin1zigfSe6BKAhQk/G2Hy7RQANIFpyiG+G635Nkvvvf3eLkNsVyO77d994gA7LkLtDkE+uxQE9+A9MqPaT95jooBgPCiz/RJTT9jChnRHvPOGIMoCCiBZ+SOpWdQ49aDNyB3vQbhny6BDky3MZfTAAABofSURBVAFakxE9TloamV5Bijhb/olIBFACnVBEKUCByAUBdauKm//6dcb1k3v1aQXy0/4edDzE3zvR/MnjzvWniwE6fqbHdJx++BlqXiKgtFPBhpAZRpDQmrqsc0FAqcs/UwDtRuv2XONffN4+xbvHdP8pftSDdsuQu0OQ+3XKXy/8FO8bCYg6mjxEg4BS7xpqMqJ5bT8nlNZ5whEFASUu/0wClCPaKs9FASUg2rFEIJTKZ5s26/jPROMU0N2CO4uwjYTlnzAA1w5odKTvSRp3oiCh1BcDQ9o5x38Sjd5fVdd5qgWUsPwTBuAqPouPVRaG6ImjEaIQoVxAKetFc9t+yPEue/vFBQA9I2qAzo1hREcYYYTeJaQd7UTLADq+8VQN6ICoAQoZ/ZH+vEfiePvFphPtfzCdP3nHmAMyShtHlLX9Iqj99LlIOaAtoqFiwwBcyaI5UmWdER3tMutvYLvvNw+vJoTeMWbReWkjiLI2sIW1mz4oqQfUIRooNgwA2IGub9kxsbIGRKvqdPD4cXIQ+X4fOKEcETrVMohoLqCu81wloIHNnGEAjrDyQQzpooAOI31Dxi3Ygzpm9t1I31zftWrfMKE9aMMolnYA0SxAh6F9HzNSIy7ykNRtcc/qQY9gB3q9gB66brSBqvtmugV4V3n7/egUhg7THX4PenuGFEgbRjT9HnR047lHjeSI0i/qnfpvePegGwS070Z7nkID8P782qm7Lxi607B6RsG0ycd/gvKMk1zsg0ZyRCchQD008YgwAJsE9OAYjQB6ODF6Nw4ZwdQxGkgbSCilOLPEtQIKoYlGhAHYKqANdx2h+LvKhlFoFckO4dS/IR1p3omyiwOmuQeM5IgnFQQ0jCYaEQZgu4A2KLmRPvp5zzDWAyFhTOsgo1NEecUJ9tz7iZEccaxCO4vgaKIRYQA2Dagb6WOAug60ZTQYctqdtsZbGFIfUU5xkPsKDYDS0EQjwgBsGdD2OemIz1IafrqPHGkz6k5PaYOMjhElFyfydHbO2gUAPaGZ2zgwAAYoOt1pvNQ+zuhh1p1CjJ4RJRYnfvzRKWOLAjrpNS8C6HjZ8Z8+fV7gPG5NgDpCW1qCiE72giAx6owjTAFGB0QpudxRpnkuDSg4oF8CUG/Z8b+7U7w+5Z4sN5UqQBtCh2M7QETHF/uQcUbPaQ/d6fyGlLj+c4A8ahzyJA4ocq95EUC9ZcfP7tfN/zKlFFBwYnNgu6cIo7O0W0qnjB7juTzfKcSLs6caQxGjgEYfgy4yxHvLjl99+tfsEV4ZoIfb8WP1FNHwfmQYooG0W0ZHzzpNJ4rlcseb5ikJKPEJ/VIPSedlx++++dfsEV41oBNEfVwnIcPdKJa2Y/R0d4pMxZs8tROKE3xZC4sGKOfl0UUAnSw7flZlj/DaAJ29qD+P9JPudB4ywGgk7Xas725OaxjR+UslSnH2VCMccYLhGc3ydV6yB/WXHb/6JHuE1wZodZy/B+qmOxEPDpkzGkr7PIunf2iqGhKPxzONrQF85VlPI0BZwdKOZrL6cQg97TV1A1peugCtGkCBRr+7q8jb3s8YDRgn8yDdPOf2gkO0HfXdt4EX8jUUYZYRJJOBiKPM/dj8DxzQDVBUwpXlJixDH0m6PcXp2yH7jNIAbS44RN0/uoG+m3QK/y4J0AP2eSwccZS54L2mAYpKuLKCgHL36x4xSga0uh0utIhGd9cWBZSwszcvJNsIA7BxQB2hhwCh3JDItCc45O3owhFMc5J2bAr+PuMelLSzNysk1wgDsHVAD/XxABKaFBKf9jTV7diJrlCmhtxLVNBSRhiArS2amztLAnogflzfajr3HkGUXBxq2usBdHGpA/RAJJSeNpHR+eKQIKIG6HJSCSiFUFbaBEZvoZABRBl/HFQjNaIBiku6soQAPcQZBQHNX/5JJNQADUknoARCE9LGGL0NhgQQNUCXkz5AiV1oWtpBRsOAAohy0qYRaoCGpBTQOKHJaYOMhrd4aJWz/JNEqAEaklZAo4TmpD1nNAJoxvJPAzRPCgGldaGZafuM3sZDJi3/bI0UQg3QkNQCGiM0P+0RowRAE5Z/Dkbiyj5OyAWMMryxtWFADydGb4khOcs/R0YDNEMaASURWiptxygVUPbxn8M7WKqRHlLeKMMbW4oBddzQt6IP/iCU9tkYm/fkaXT8Z3xD0SFilFADNCTdgDK2og/+IJD2yHjLm/c0HP9J2JLZAM2WZkDdDM2bG3FA+wGePu+pzx8D0CihBmhIKgE9daENoA2iN3ObAKAH8rynQx2bcj9POxLYAA1JNaANoW0HCjBa7h701nNSt3tyiNLvQQ3QZOkG9HA7kHkzhbRY2j6gB/J2T8zTP/GYBmhIOgE9d6FjKj1GS6U9epk16u9IOMURHafN20Aq32mALgHoYTK2nxkVBTTSjZ6MMUS9tDFCDdCQVgbo4cRoobSRI79I2z3hiBqg2VIK6InQG+jzJMeoPKAH2nZPGKJ+RP4WfDlOA3QZQAOfeIIvn/hpe8FBJ2G7J/LyzzChBmhIawW0Mc4e7BPSjgN6IGz3RF3+aYDypR/QAKGdkcAolrYfGnHGtnsiLv8MEmqAhqQV0IHQCKCHOKNFAD1Et3uiLf9M2WU30WmALgUoTOg4JMookvYkcDSX+LQnyvJPA5SrNQAKEjoJGWa0IKCHyLQnwvLPAKEGaEhqAe0JpQJ6AD4NjaU9DUvMJfYOf4IoEBH+XQM0pFUAChEKhwQYDaVdzXYipRenYxScLOIhaoBm68oAPcwZDRhH+9VGQ0JpN4wGpttFln+mnPSQ4jRAhQHtGrqHbU4oFpIyqyQX0CaCYxT6cWT5J0SoARrSSgCdExoJGZ1V4vjMBLTRHr4hRZd/GqAcXSugh+isklkHyi5OTzgIKbb8EyDUAA1pLYCmPXK7B/uAkXNbGzcCjI6Wf87c6UkboLikK8tzOkLzAHUKvCEtC+gB6kiH5Z9za3rSBigu6coKA5ryVn0wAozSXq2GQ8KaQhqaRTIj1AANaT2Asj44nxmnjMoA6jRmtA4hOiXUAA1JM6CO0FKAHnxGox/v00IGtB9/aA8SaoBStSJAaZM30YgDo5EJUpyQIbWQtkawE6UdKJqYdhGjDG9sbQvQQ/+J/QKAOg0dKYSoT6gBGpJqQBtCvTtHfAERPe3Ag71E2/ejPYDo3jcKpJ1nlOGNrVUBGlojzE37FmZUqu1bSGeIGqAkbRHQPsqMUcm2bxidIko4M7xM2mlGGd7YWheg831qEtIeUe4zKtz2M0T3AaNA2glGGd7Y0g3o4TgdiG8DRkba/hPSiNEF2v54HL0lNUAJQgB9/asHD76q67dfPvjsh+GadGUtAOj8Cf6m7GYluPE4epO/x4wCabOMS9BHUBjQt7/9rn79j9+9//ar+sUvh4vSlTUHdDrl6BY20tMObgQR300xFJJldOP88CZ/PyRpgIYUBvQnR+Wfv3r7u+/r17/+vr8oXVkTZ1Udp9TkAho8msHtlEskNLPcx+MwlXQ//FEYoCHh96BNL/r6Nz+0nWld/6zRMpk6qQV0cu02L2Tw1x00bnbeAqqOXbEqR+gSCa5YaP28//aL+qfPBkCdpP+aZz1oQ+jUQjp1KxQxfLZNv6M3ZT+d3HK7YvmbiFsPGhIG6Nsvv2gelX5zQUDbppxacgDFzl463YNGGc0ut0vK20TcAA0JfYpvnuHri96DtoIJLQ/o2IlvTFao3KPXogZoSGFAOz7bYf5yT/GtpoSmA8o6vC5psxKe8YSoARpSGNAXD5y+uux70E7Tt6G3qWlzT1eUn1XCPf3TAMUlXVmhFzNzQlPSTjmfVnpWCfP0TwMUl3RlhZzH2aSRpQA9iM8qQZZ/poYsYZThja2VADonNCHtCJ9YyBvKZiWsiGMFl3+mhzRAZSorDOh06jI/7RifsZDlj8A5i3IqmFTaBmiREWxK6PKAHkofgeMZqYgaoKikKwtxIss/SBHjv0DKZcEjcCZGGqIGKCrpysKcx/AKOkrEQoAeih2BMzcyj/+UNcrwxtaKAPUJramE9hEJdkZxiIyyKyhOqAGKSrqycOeY0MsCeoh9GpoS0SnaiRqgqKQrK+IcEVpHkJvMw7id/yD4G1HVwy90jIZ/MVQabGvSCKIGKCrpyoo5G0JvTsbI1KTxTLZb4AfB3yBmsvuFbip+4BcDpZkn5RlRRA1QVNKVFXWeNhvRAig6FT8NUBRRAxSVdGXFnQOhzogQ6gN6C/0g+BvETJ4AbafiI0ZCUjMj9fjPWCbTjTK8sbU6QAdCI4D696C30A+CvxHV6R60On9lndFE2R6fePxnUAbohQDtCZ2M3GhE4gN/ZnEYZzTRItKO/2SFZBhleGNrhYB2hE4fzpGIzBdSGcbS054AQg1QVNKVRXM6QlUCOkU0O+K8EzVAUUlXFtF53jiU8AEm+0PRPGPheXlTRA1QVNKVRXUeDzW2V7IXcWFAi8/L8xE1QFGVrYMM57EOH+Ppi8xnyeLcnF7Wlog4RtQARVW2DnKcp1E+BuBFAO0RLRYxcvxnSsiYUYY3ttYMaAdBBED6zObSxQmfcpcSET3+My0kbpThja3VAlqfTkpECWWsDREoTtGJo8z1nwbohQE9neWpGNCaiij55YUBiqtsHeQ46wOFUM76ZKG2J81tpr68OBqguMrWQY7TGeOEKgD0QBnp6bfeiy3/lOGNrVUDOhAaBJS1R45k51Rsv7zm3nuh5Z8yvLG1bkBjhEKAkmczzYz8zRJHRnCkn0X0JkiFQi6z/FOGN7ZWDihOKLQNHnk+6MyYsN2sb5whOos4nmKKzYFeYvmnDG9srR3QnlAQUHCn2wsCOkM0GVAKogaoDkARQvUBOkE0A9A4ogaoEkB7Qud3eLdwxAvdg540vhlNuwcdJLv8U4Y3tq4A0K6hbmeEBgAtm3aSMWPqvecUXf4pwxtb1wAoTCj7QKXlAM2Yej9xCi7/lOGNrasAtCX0NnAyskpAk8+xnTnFln/K8MbWdQAKEMo/1HNZQA9eN5qTSaHlnzK8sXUlgDpCbw8jQhPO7V4c0BGieZkUWf4pwxtb1wLolNB1AMrfEjfgBBA1QHUB6hN6ixgF0s4y3tyUyOQMUQNUJaDzdSDqAXWIlshk4eWfMryxdT2Ajgm9RY0Caecai2zaXHb5pwxvbF0RoA2hLZiTqSOrALQmLw9BQ5Zc/inDG1vXBOiJ0LTdPS4MKBHRSMhyyz9leGPrqgDtCfVfiK4HUBKi0ZClln/K8MbWdQF6OHaAeqctLJV2EWOJs+rLLP+U4Y2tKwO0IbTqhnny1KOTMTqbaZp2dOpReD7U9PtxJh2imZuYNoiydzudXdahawO0Ola33b7cxMmbp6mX0fmg07SjkzeRGaXT7/1Mhre9RzLl63gkE2qALgpoQ2hHzc16AXXb3mcCOtQDQQbosoA2LdN9vVkxoFU2oNaDhotGroMcZ8joCD12X2kfc6u7B+1+EHhWImNH7kANUI6xUMjhZSBrhzkVT/EnhR7miSHztyCR4Y2t6wR0TOhKAQ0RaoCiSqqsS0AyvK5mnJ19TYAe7T0ovbI4xoIhB0LXCmiAUFLIEtvgyfDG1vUCeiKUOk/IAPUv69AVA3r6yK/kLrJLGsF8U0LaR52MyuIZC4fsexIiodcC6LFA2gZorpP1sFBym+MFjZzjP0cyQBmVxTQWD3k8tkYSoVcCqE23Y1QW1ygQsmuvgvtwG6BL6voBrU9vRC+QdqYRyDP19ZoBWqAOcpwMI5XQqwDUlnwwKotvlGn7/mOlGKHctFl7JYLO6KzqeZYNUFS8yuIbpTon0o0oM23ObrMH7zfm3xcD9Lys0wBdE6CkYV4hoPMM45m0ZceMykoxyt3eEYZ5A9S7rEObAfQ0zJcLucA96Dy/aCbHW4sYoGsDNEqovqf4gwG6JUD7YT74qKQS0CmhWEjbm2nlgEY60bUD6m9vZ4CuEVCUUJ2ATjJrgKIiFY1cBznOVONxOCL5AmmnGamA2v6g9TUAGj74a+WA2g7LTmXrIMeZYQwN80oB9XNqgKIqWwc5zhxjgNBVAzo7RcEAXS+ggRtRrYCStjs1QFuVrYMcZ6YRInTNgNoxNJ3K1kGOM9cIPCqpBTS+Hy9wkpcBum5AgWHeAPUu69B2AZ0P83oBHeUSdNpRiIPK1kGOs4TRJ5S8s+EQMn020+w3Q8ZB5+1CwWc+StpBGaBqAe2G+Z5Q8t6wQ8j0+aDz3wwYz9/fYBPzDNDr1bH57+bG/auFgvOrwy/Qf3H6G8HfnP6gBTQY9kjP8/q07R70MBrmNfegN+ihJXZe/Fll6yDHWcx4GubV3oPe3Iy+nxcH5tMALVAHOc6CxoFQnU/xN5HJIgE+DdACdZDjLGlsCWXsxbygcTbrygBFVbYOcpxFjd2NqD5AgUmBU2eITwO0QB3kOMsax++blk47aAQXT02cQT4N0AJ1kOMsbXQ7iaraijmwts8ARVW2DnKcxY3u4BZFWzHTlp6G+TRAC9RBjrO80Q3ztBMX5DMZzocBiqpsHeQ4JdKm3ohKZxL7M/GcCJ8GaIE6yHGKpE0kVDaTeC8+dmJ8GqAF6iDHKZN2O8xfIO2zMXaTYYCiKlsHOU6ptCmEymUyfg88ConyaYAWqIMcp1jahEclqUzyTnrA+TRAC9RBjlMu7fiNqFAmmW8QDFBAZesgxymYdvRGNDvt2fynmnymaD1EiPBpgBaogxynaNoRQnPTns8grclH3tZDhGNkcqABesWARm5EiwNKP5F5APR4jM1eNUCvGVB8mC8MKGemX+s8OjwNUEhl6yDHKZ42QmjRe9Ab1lxpB+fxQJn+b4BeOaAIoQXT7gd3YsRjfzZumbRxowxvbBmgYWfTVQlvxXy696RE7LpOAxRV2TrIcS6S9pE0aTg57ch+IeOMHI+FDjEmG2V4Y8sARZ3wMF8m7TH7qPEEZ7m0CUYZ3tgyQHEnOMyXSJu6sZ5HZ6G0SUYZ3tgyQGNOgND8tKd3DoGkp3QWSZtolOGNLQM06pwTmpv2/MYWuruYw1kibbJRhje2DNC4c/aolJc25YCRAJ3ZaTOMMryxZYASnNMb0Zy04U81x0ZoYC+TNssowxtbBijJeSy1FXPs1T8KZ2baPKMMb2wZoDTnschWzJFzbKN05qTNNcrwxpYBSnQej2e6EtNG50fhA3sopKBRhje2DFCy89yJJqWNTakjwpmcdopRhje2DFC680RoQtoIno5OhRUkwxtbBijD2QzzaWkH8RwGdoUVJMMbWwYoy9kRykw7hOdoYFdYQTK8sWWA8pztoxIr7QCe/m2nwgqS4Y0tA5TpdMM8J20Qz9lDkcIKkuGNLQOU7TwytmIGuk/wfZLCCpLhjS0DlO88UtdgzvEMvU9SWEEyvLFlgCY4j6RlwrPFmsjbToUVJMMbWwZoSshjvBOdLNaMfFCksIJkeGPLAE0LGSHUX6wZ/6BIYQXJ8MaWAZoYEiPUW6xJ+hhTYQXJ8MaWAZoaMszdGV3qDBCNFSTDG1sGaHpIuBM9dZ8iuywYoLikK2tVgEKEDnhK7bJggOKSrqx1ATob5js8JXdZMEBxSVfWygD1tzlu8RTeZcEAxSVdWasD9Eyow1N+lwUDFJd0Za0P0EO7V2eD5zK7LBiguKQra4WAHqpjdbPYLgsGKC7pyloloG4/7qIRizgN0HXXf7mQ8yMRciMWcRqg667/giHD23EryiTbKMMbWwaoirQVZlKGN7YMUBVpK8ykDG9sGaAq0laYSRne2DJAVaStMJMyvLFlgKpIW2EmZXhjywBVkbbCTMrwxpYBqiJthZmU4Y0tA1RF2gozKcMbWwaoirQVZlKGN7YMUBVpK8ykDG9sGaAq0laYSRne2DJAVaStMJMyvLFlgKpIW2EmZXhjywBVkbbCTMrwxpYBqiJthZmU4Y0tA1RF2gozKcMbWwaoirQVZlKGN7YMUBVpK8ykDG9sGaAq0laYSRne2DJAVaStMJMyvLFlgKpIW2EmZXhjywBVkbbCTMrwxpYBqiJthZmU4Y0tA1RF2gozKcMbWwaoirQVZlKGN7aYgCbqZxsNudVMFpQBKhlyq5ksKANUMuRWM1lQBqhkyK1msqCWAdRkSpQBalItA9SkWgaoSbUMUJNqLQDo6189ePBV2ZA/PXjwt9+XDVnX778tm8sXD4rn8v23D/7mu5IBXR6Lt05RyQP69rff1a//sWi1vv719/WLX5aM6PSicEP9uXy7NyF/+uyHwkHLRywpeUB/ciSVbywHadmA//TPRTP5/o9F/yid3v6u+LDRdSCKtcw9qEAllO5B3//x38oO8W+/LD54vv7N/yo8xNflK7KwFgH0/bdfFI74+lelG+rFF4XvQd1tTeFe9PWvvmogLTsgK+9AFwH07Zel+ayLV2zT7qUfkpzK3to4OEsDpfsOdKGneJGnxLJt3z3OFv9DKpvJt/+9PKB/Fug8SkoeUAE+3V99+aGpcA/qMvn+f5Z9qvlz8SFe4FGurOQBlXjV1sQs/rAg8R60dCabB6/Cb1a134LaJ0km3TJATaplgJpUywA1qZYBalItA9SkWgZoSC8/fPrqk8fTq8Alk6QM0JAaQIGrBujCMkBDMkBVyACF9OZh9cHvuyH+1cdVVT1qwPx9VX303ABdWgYooDcP7zf/tYC2QL76+NGrjz98+u7rewbo0jJAAbWj+7MO0J93A33DaDu+G6ALywAF9KwZy+sGTUfjk6q6V/f3nm8ePjJAF5YBCmgMaHtD2r9xMkCXlwEKqB3iR+9BHZjtEP9z6NWoSVIGKKA3D+8ND0ktq+7e0x6SLiMDFNLoNdPLqqo+eNy9Zrpn70EXlwFKk4F5IRmgNBmgF5IBSpMBeiEZoCbVMkBNqmWAmlTLADWplgFqUi0D1KRaBqhJtf4/Ruv9NI/t5QMAAAAASUVORK5CYII=" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. The convex hulls of points, grouped by 7 types of cars, are displayed as multiple polygons with no fill, but the outer line is coloured by the type." style="display: block; margin: auto;" /></p>
<p>There are a few things to note here:</p>
<ul>
<li><p>We override <code>draw_group()</code> instead of
<code>draw_panel()</code> because we want one polygon per group, not one
polygon per row.</p></li>
<li><p>If the data contains two or fewer points, there’s no point trying
to draw a polygon, so we return a <code>nullGrob()</code>. This is the
graphical equivalent of <code>NULL</code>: it’s a grob that doesn’t draw
anything and doesn’t take up any space.</p></li>
<li><p>Note the units: <code>x</code> and <code>y</code> should always
be drawn in “native” units. (The default units for
<code>pointGrob()</code> is a native, so we didn’t need to change it
there). <code>lwd</code> is measured in points, but ggplot2 uses mm, so
we need to multiply it by the adjustment factor
<code>.pt</code>.</p></li>
</ul>
<p>You might want to compare this to the real <code>GeomPolygon</code>.
You’ll see it overrides <code>draw_panel()</code> because it uses some
tricks to make <code>polygonGrob()</code> produce multiple polygons in
one call. This is considerably more complicated, but gives better
performance.</p>
</div>
<div id="inheriting-from-an-existing-geom" class="section level3">
<h3>Inheriting from an existing Geom</h3>
<p>Sometimes you just want to make a small modification to an existing
geom. In this case, rather than inheriting from <code>Geom</code> you
can inherit from an existing subclass. For example, we might want to
change the defaults for <code>GeomPolygon</code> to work better with
<code>StatChull</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>GeomPolygonHollow <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;GeomPolygonHollow&quot;</span>, GeomPolygon,</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="at">default_aes =</span> <span class="fu">aes</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">linewidth =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="dv">1</span>,</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="cn">NA</span>)</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  )</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>geom_chull <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">mapping =</span> <span class="cn">NULL</span>, <span class="at">data =</span> <span class="cn">NULL</span>, </span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>                       <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">show.legend =</span> <span class="cn">NA</span>, </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>                       <span class="at">inherit.aes =</span> <span class="cn">TRUE</span>, ...) {</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>  <span class="fu">layer</span>(</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>    <span class="at">stat =</span> StatChull, <span class="at">geom =</span> GeomPolygonHollow, <span class="at">data =</span> data, <span class="at">mapping =</span> mapping,</span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>    <span class="at">position =</span> position, <span class="at">show.legend =</span> show.legend, <span class="at">inherit.aes =</span> inherit.aes,</span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(<span class="at">na.rm =</span> na.rm, ...)</span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  )</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>}</span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span> </span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>  <span class="fu">geom_chull</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of engine displacement versus highway miles per gallon, for 234 cars. The convex hull of all the points is marked by a polygon with no fill." style="display: block; margin: auto;" /></p>
<p>This doesn’t allow you to use different geoms with the stat, but that
seems appropriate here since the convex hull is primarily a polygonal
feature.</p>
</div>
<div id="exercises-1" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Compare and contrast <code>GeomPoint</code> with
<code>GeomSimplePoint</code>.</p></li>
<li><p>Compare and contrast <code>GeomPolygon</code> with
<code>GeomSimplePolygon</code>.</p></li>
</ol>
</div>
</div>
<div id="geoms-and-stats-with-multiple-orientation" class="section level2">
<h2>Geoms and Stats with multiple orientation</h2>
<p>Some layers have a specific orientation. <code>geom_bar()</code>
e.g. have the bars along one axis, <code>geom_line()</code> will sort
the input by one axis, etc. The original approach to using these geoms
in the other orientation was to add <code>coord_flip()</code> to the
plot to switch the position of the x and y axes. Following ggplot2 v3.3
all the geoms will natively work in both orientations without
<code>coord_flip()</code>. The mechanism is that the layer will try to
guess the orientation from the mapped data, or take direction from the
user using the <code>orientation</code> parameter. To replicate this
functionality in new stats and geoms there’s a few steps to take. We
will look at the boxplot layer as an example instead of creating a new
one from scratch.</p>
<div id="omnidirectional-stats" class="section level3">
<h3>Omnidirectional stats</h3>
<p>The actual guessing of orientation will happen in
<code>setup_params()</code> using the <code>has_flipped_aes()</code>
helper:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>StatBoxplot<span class="sc">$</span>setup_params</span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a><span class="co">#&gt; &lt;ggproto method&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="co">#&gt;   &lt;Wrapper function&gt;</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt;     function (...) </span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; setup_params(..., self = self)</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt;   &lt;Inner function (f)&gt;</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt;     function (self, data, params) </span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt;     params$flipped_aes &lt;- has_flipped_aes(data, params, main_is_orthogonal = TRUE, </span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt;         group_has_equal = TRUE, main_is_optional = TRUE)</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a><span class="co">#&gt;     data &lt;- flip_data(data, params$flipped_aes)</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a><span class="co">#&gt;     has_x &lt;- !(is.null(data$x) &amp;&amp; is.null(params$x))</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co">#&gt;     has_y &lt;- !(is.null(data$y) &amp;&amp; is.null(params$y))</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="co">#&gt;     if (!has_x &amp;&amp; !has_y) {</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a><span class="co">#&gt;         cli::cli_abort(&quot;{.fn {snake_class(self)}} requires an {.field x} or {.field y} aesthetic.&quot;)</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="co">#&gt;     params$width &lt;- params$width %||% (resolution(data$x %||% </span></span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="co">#&gt;         0) * 0.75)</span></span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a><span class="co">#&gt;     if (!is_mapped_discrete(data$x) &amp;&amp; is.double(data$x) &amp;&amp; !has_groups(data) &amp;&amp; </span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a><span class="co">#&gt;         any(data$x != data$x[1L])) {</span></span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a><span class="co">#&gt;         cli::cli_warn(c(&quot;Continuous {.field {flipped_names(params$flipped_aes)$x}} aesthetic&quot;, </span></span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a><span class="co">#&gt;             i = &quot;did you forget {.code aes(group = ...)}?&quot;))</span></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a><span class="co">#&gt;     params</span></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>Following this is a call to <code>flip_data()</code> which will make
sure the data is in horizontal orientation. The rest of the code can
then simply assume that the data is in a specific orientation. The same
thing happens in <code>setup_data()</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>StatBoxplot<span class="sc">$</span>setup_data</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; &lt;ggproto method&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt;   &lt;Wrapper function&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co">#&gt;     function (...) </span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a><span class="co">#&gt; setup_data(..., self = self)</span></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="co">#&gt;   &lt;Inner function (f)&gt;</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a><span class="co">#&gt;     function (self, data, params) </span></span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb20-10"><a href="#cb20-10" tabindex="-1"></a><span class="co">#&gt;     data &lt;- flip_data(data, params$flipped_aes)</span></span>
<span id="cb20-11"><a href="#cb20-11" tabindex="-1"></a><span class="co">#&gt;     data$x &lt;- data$x %||% 0</span></span>
<span id="cb20-12"><a href="#cb20-12" tabindex="-1"></a><span class="co">#&gt;     data &lt;- remove_missing(data, na.rm = params$na.rm, vars = &quot;x&quot;, </span></span>
<span id="cb20-13"><a href="#cb20-13" tabindex="-1"></a><span class="co">#&gt;         name = &quot;stat_boxplot&quot;)</span></span>
<span id="cb20-14"><a href="#cb20-14" tabindex="-1"></a><span class="co">#&gt;     flip_data(data, params$flipped_aes)</span></span>
<span id="cb20-15"><a href="#cb20-15" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>The data is flipped (if needed), manipulated, and flipped back as it
is returned.</p>
<p>During the computation, this sandwiching between
<code>flip_data()</code> is used as well, but right before the data is
returned it will also get a <code>flipped_aes</code> column denoting if
the data is flipped or not. This allows the stat to communicate to the
geom that orientation has already been determined.</p>
</div>
<div id="omnidirecitonal-geoms" class="section level3">
<h3>Omnidirecitonal geoms</h3>
<p>The setup for geoms is pretty much the same, with a few twists.
<code>has_flipped_aes()</code> is also used in
<code>setup_params()</code>, where it will usually be picked up from the
<code>flipped_aes</code> column given by the stat. In
<code>setup_data()</code> you will often see that
<code>flipped_aes</code> is reassigned, to make sure it exist prior to
position adjustment. This is needed if the geom is used together with a
stat that doesn’t handle orientation (often
<code>stat_identity()</code>):</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>GeomBoxplot<span class="sc">$</span>setup_data</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co">#&gt; &lt;ggproto method&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt;   &lt;Wrapper function&gt;</span></span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a><span class="co">#&gt;     function (...) </span></span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a><span class="co">#&gt; setup_data(...)</span></span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="co">#&gt;   &lt;Inner function (f)&gt;</span></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="co">#&gt;     function (data, params) </span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a><span class="co">#&gt;     data$flipped_aes &lt;- params$flipped_aes</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a><span class="co">#&gt;     data &lt;- flip_data(data, params$flipped_aes)</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="co">#&gt;     data$width &lt;- data$width %||% params$width %||% (resolution(data$x, </span></span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a><span class="co">#&gt;         FALSE) * 0.9)</span></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co">#&gt;     if (!is.null(data$outliers)) {</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a><span class="co">#&gt;         suppressWarnings({</span></span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="co">#&gt;             out_min &lt;- vapply(data$outliers, min, numeric(1))</span></span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="co">#&gt;             out_max &lt;- vapply(data$outliers, max, numeric(1))</span></span>
<span id="cb21-18"><a href="#cb21-18" tabindex="-1"></a><span class="co">#&gt;         })</span></span>
<span id="cb21-19"><a href="#cb21-19" tabindex="-1"></a><span class="co">#&gt;         data$ymin_final &lt;- pmin(out_min, data$ymin)</span></span>
<span id="cb21-20"><a href="#cb21-20" tabindex="-1"></a><span class="co">#&gt;         data$ymax_final &lt;- pmax(out_max, data$ymax)</span></span>
<span id="cb21-21"><a href="#cb21-21" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb21-22"><a href="#cb21-22" tabindex="-1"></a><span class="co">#&gt;     if (is.null(params) || is.null(params$varwidth) || !params$varwidth || </span></span>
<span id="cb21-23"><a href="#cb21-23" tabindex="-1"></a><span class="co">#&gt;         is.null(data$relvarwidth)) {</span></span>
<span id="cb21-24"><a href="#cb21-24" tabindex="-1"></a><span class="co">#&gt;         data$xmin &lt;- data$x - data$width/2</span></span>
<span id="cb21-25"><a href="#cb21-25" tabindex="-1"></a><span class="co">#&gt;         data$xmax &lt;- data$x + data$width/2</span></span>
<span id="cb21-26"><a href="#cb21-26" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb21-27"><a href="#cb21-27" tabindex="-1"></a><span class="co">#&gt;     else {</span></span>
<span id="cb21-28"><a href="#cb21-28" tabindex="-1"></a><span class="co">#&gt;         data$relvarwidth &lt;- data$relvarwidth/max(data$relvarwidth)</span></span>
<span id="cb21-29"><a href="#cb21-29" tabindex="-1"></a><span class="co">#&gt;         data$xmin &lt;- data$x - data$relvarwidth * data$width/2</span></span>
<span id="cb21-30"><a href="#cb21-30" tabindex="-1"></a><span class="co">#&gt;         data$xmax &lt;- data$x + data$relvarwidth * data$width/2</span></span>
<span id="cb21-31"><a href="#cb21-31" tabindex="-1"></a><span class="co">#&gt;     }</span></span>
<span id="cb21-32"><a href="#cb21-32" tabindex="-1"></a><span class="co">#&gt;     data$width &lt;- NULL</span></span>
<span id="cb21-33"><a href="#cb21-33" tabindex="-1"></a><span class="co">#&gt;     if (!is.null(data$relvarwidth)) </span></span>
<span id="cb21-34"><a href="#cb21-34" tabindex="-1"></a><span class="co">#&gt;         data$relvarwidth &lt;- NULL</span></span>
<span id="cb21-35"><a href="#cb21-35" tabindex="-1"></a><span class="co">#&gt;     flip_data(data, params$flipped_aes)</span></span>
<span id="cb21-36"><a href="#cb21-36" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
<p>In the <code>draw_*()</code> method you will once again sandwich any
data manipulation between <code>flip_data()</code> calls. It is
important to make sure that the data is flipped back prior to creating
the grob or calling draw methods from other geoms.</p>
</div>
<div id="dealing-with-required-aesthetics" class="section level3">
<h3>Dealing with required aesthetics</h3>
<p>Omnidirectional layers usually have two different sets of required
aesthetics. Which set is used is often how it knows the orientation. To
handle this gracefully the <code>required_aes</code> field of
<code>Stat</code> and <code>Geom</code> classes understands the
<code>|</code> (or) operator. Looking at <code>GeomBoxplot</code> we can
see how it is used:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>GeomBoxplot<span class="sc">$</span>required_aes</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="co">#&gt; [1] &quot;x|y&quot;            &quot;lower|xlower&quot;   &quot;upper|xupper&quot;   &quot;middle|xmiddle&quot;</span></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a><span class="co">#&gt; [5] &quot;ymin|xmin&quot;      &quot;ymax|xmax&quot;</span></span></code></pre></div>
<p>This tells ggplot2 that either all the aesthetics before
<code>|</code> are required or all the aesthetics after are
required.</p>
</div>
<div id="ambiguous-layers" class="section level3">
<h3>Ambiguous layers</h3>
<p>Some layers will not have a clear interpretation of their data in
terms of orientation. A classic example is <code>geom_line()</code>
which just by convention runs along the x-axis. There is nothing in the
data itself that indicates that. For these geoms the user must indicate
a flipped orientation by setting <code>orientation = &quot;y&quot;</code>. The
stat or geom will then call <code>has_flipped_aes()</code> with
<code>ambiguous = TRUE</code> to cancel any guessing based on data
format. As an example we can see the <code>setup_params()</code> method
of <code>GeomLine</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>GeomLine<span class="sc">$</span>setup_params</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="co">#&gt; &lt;ggproto method&gt;</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a><span class="co">#&gt;   &lt;Wrapper function&gt;</span></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="co">#&gt;     function (...) </span></span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a><span class="co">#&gt; setup_params(...)</span></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="co">#&gt;   &lt;Inner function (f)&gt;</span></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="co">#&gt;     function (data, params) </span></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="co">#&gt; {</span></span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="co">#&gt;     params$flipped_aes &lt;- has_flipped_aes(data, params, ambiguous = TRUE)</span></span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="co">#&gt;     params</span></span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="co">#&gt; }</span></span></code></pre></div>
</div>
</div>
<div id="creating-your-own-theme" class="section level2">
<h2>Creating your own theme</h2>
<p>If you’re going to create your own complete theme, there are a few
things you need to know:</p>
<ul>
<li>Overriding existing elements, rather than modifying them</li>
<li>The four global elements that affect (almost) every other theme
element</li>
<li>Complete vs. incomplete elements</li>
</ul>
<div id="overriding-elements" class="section level3">
<h3>Overriding elements</h3>
<p>By default, when you add a new theme element, it inherits values from
the existing theme. For example, the following code sets the key colour
to red, but it inherits the existing fill colour:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">theme_grey</span>()<span class="sc">$</span>legend.key</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="co">#&gt; List of 5</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="co">#&gt;  $ fill         : chr &quot;grey95&quot;</span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="co">#&gt;  $ colour       : logi NA</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="co">#&gt;  $ linewidth    : NULL</span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="co">#&gt;  $ linetype     : NULL</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="co">#&gt;  $ inherit.blank: logi TRUE</span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr [1:2] &quot;element_rect&quot; &quot;element&quot;</span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a>new_theme <span class="ot">&lt;-</span> <span class="fu">theme_grey</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>new_theme<span class="sc">$</span>legend.key</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a><span class="co">#&gt; List of 5</span></span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a><span class="co">#&gt;  $ fill         : chr &quot;grey95&quot;</span></span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a><span class="co">#&gt;  $ colour       : chr &quot;red&quot;</span></span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a><span class="co">#&gt;  $ linewidth    : NULL</span></span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a><span class="co">#&gt;  $ linetype     : NULL</span></span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a><span class="co">#&gt;  $ inherit.blank: logi FALSE</span></span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr [1:2] &quot;element_rect&quot; &quot;element&quot;</span></span></code></pre></div>
<p>To override it completely, use <code>%+replace%</code> instead of
<code>+</code>:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>new_theme <span class="ot">&lt;-</span> <span class="fu">theme_grey</span>() <span class="sc">%+replace%</span> <span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>))</span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>new_theme<span class="sc">$</span>legend.key</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; List of 5</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt;  $ fill         : NULL</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt;  $ colour       : chr &quot;red&quot;</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt;  $ linewidth    : NULL</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt;  $ linetype     : NULL</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt;  $ inherit.blank: logi FALSE</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt;  - attr(*, &quot;class&quot;)= chr [1:2] &quot;element_rect&quot; &quot;element&quot;</span></span></code></pre></div>
</div>
<div id="global-elements" class="section level3">
<h3>Global elements</h3>
<p>There are four elements that affect the global appearance of the
plot:</p>
<table>
<colgroup>
<col width="23%" />
<col width="33%" />
<col width="42%" />
</colgroup>
<thead>
<tr class="header">
<th>Element</th>
<th>Theme function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>line</td>
<td><code>element_line()</code></td>
<td>all line elements</td>
</tr>
<tr class="even">
<td>rect</td>
<td><code>element_rect()</code></td>
<td>all rectangular elements</td>
</tr>
<tr class="odd">
<td>text</td>
<td><code>element_text()</code></td>
<td>all text</td>
</tr>
<tr class="even">
<td>title</td>
<td><code>element_text()</code></td>
<td>all text in title elements (plot, axes &amp; legend)</td>
</tr>
</tbody>
</table>
<p>These set default properties that are inherited by more specific
settings. These are most useful for setting an overall “background”
colour and overall font settings (e.g. family and size).</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>base</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of three observations arranged diagonally. The axis titles &#39;x&#39; and &#39;y&#39; are coloured in black" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>base <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>))</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot of three observations arranged diagonally. The axis titles &#39;x&#39; and &#39;y&#39; are coloured in red" style="display: block; margin: auto;" /></p>
<p>You should generally start creating a theme by modifying these
values.</p>
</div>
<div id="complete-vs-incomplete" class="section level3">
<h3>Complete vs incomplete</h3>
<p>It is useful to understand the difference between complete and
incomplete theme objects. A <em>complete</em> theme object is one
produced by calling a theme function with the attribute
<code>complete = TRUE</code>.</p>
<p>Theme functions <code>theme_grey()</code> and <code>theme_bw()</code>
are examples of complete theme functions. Calls to <code>theme()</code>
produce <em>incomplete</em> theme objects, since they represent (local)
modifications to a theme object rather than returning a complete theme
object per se. When adding an incomplete theme to a complete one, the
result is a complete theme.</p>
<p>Complete and incomplete themes behave somewhat differently when added
to a ggplot object:</p>
<ul>
<li><p>Adding an incomplete theme augments the current theme object,
replacing only those properties of elements defined in the call to
<code>theme()</code>.</p></li>
<li><p>Adding a complete theme wipes away the existing theme and applies
the new theme.</p></li>
</ul>
</div>
</div>
<div id="creating-a-new-faceting" class="section level2">
<h2>Creating a new faceting</h2>
<p>One of the more daunting exercises in ggplot2 extensions is to create
a new faceting system. The reason for this is that when creating new
facetings you take on the responsibility of how (almost) everything is
drawn on the screen, and many do not have experience with directly using
<a href="https://cran.r-project.org/package=gtable">gtable</a> and <a href="https://cran.r-project.org/package=grid">grid</a> upon which the
ggplot2 rendering is built. If you decide to venture into faceting
extensions, it is highly recommended to gain proficiency with the
above-mentioned packages.</p>
<p>The <code>Facet</code> class in ggplot2 is very powerful as it takes
on responsibility of a wide range of tasks. The main tasks of a
<code>Facet</code> object are:</p>
<ul>
<li><p>Define a layout; that is, a partitioning of the data into
different plot areas (panels) as well as which panels share position
scales.</p></li>
<li><p>Map plot data into the correct panels, potentially duplicating
data if it should exist in multiple panels (e.g. margins in
<code>facet_grid()</code>).</p></li>
<li><p>Assemble all panels into a final gtable, adding axes, strips and
decorations in the process.</p></li>
</ul>
<p>Apart from these three tasks, for which functionality must be
implemented, there are a couple of additional extension points where
sensible defaults have been provided. These can generally be ignored,
but adventurous developers can override them for even more control:</p>
<ul>
<li><p>Initialization and training of positional scales for each
panel.</p></li>
<li><p>Decoration in front of and behind each panel.</p></li>
<li><p>Drawing of axis labels</p></li>
</ul>
<p>To show how a new faceting class is created we will start simple and
go through each of the required methods in turn to build up
<code>facet_duplicate()</code> that simply duplicate our plot into two
panels. After this we will tinker with it a bit to show some of the more
powerful possibilities.</p>
<div id="creating-a-layout-specification" class="section level3">
<h3>Creating a layout specification</h3>
<p>A layout in the context of facets is a <code>data.frame</code> that
defines a mapping between data and the panels it should reside in as
well as which positional scales should be used. The output should at
least contain the columns <code>PANEL</code>, <code>SCALE_X</code>, and
<code>SCALE_Y</code>, but will often contain more to help assign data to
the correct panel (<code>facet_grid()</code> will e.g. also return the
faceting variables associated with each panel). Let’s make a function
that defines a duplicate layout:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="cf">function</span>(data, params) {</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">PANEL =</span> <span class="fu">c</span>(1L, 2L), <span class="at">SCALE_X =</span> 1L, <span class="at">SCALE_Y =</span> 1L)</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>}</span></code></pre></div>
<p>This is quite simple as the faceting should just define two panels
irrespectively of the input data and parameters.</p>
</div>
<div id="mapping-data-into-panels" class="section level3">
<h3>Mapping data into panels</h3>
<p>In order for ggplot2 to know which data should go where it needs the
data to be assigned to a panel. The purpose of the mapping step is to
assign a <code>PANEL</code> column to the layer data identifying which
panel it belongs to.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>mapping <span class="ot">&lt;-</span> <span class="cf">function</span>(data, layout, params) {</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(data) <span class="sc">||</span> <span class="fu">nrow</span>(data) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">cbind</span>(data, <span class="at">PANEL =</span> <span class="fu">integer</span>(<span class="dv">0</span>)))</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  }</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb29-6"><a href="#cb29-6" tabindex="-1"></a>    <span class="fu">cbind</span>(data, <span class="at">PANEL =</span> 1L),</span>
<span id="cb29-7"><a href="#cb29-7" tabindex="-1"></a>    <span class="fu">cbind</span>(data, <span class="at">PANEL =</span> 2L)</span>
<span id="cb29-8"><a href="#cb29-8" tabindex="-1"></a>  )</span>
<span id="cb29-9"><a href="#cb29-9" tabindex="-1"></a>}</span></code></pre></div>
<p>here we first investigate whether we have gotten an empty
<code>data.frame</code> and if not we duplicate the data and assign the
original data to the first panel and the new data to the second
panel.</p>
</div>
<div id="laying-out-the-panels" class="section level3">
<h3>Laying out the panels</h3>
<p>While the two functions above have been deceivingly simple, this last
one is going to take some more work. Our goal is to draw two panels
beside (or above) each other with axes etc.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>render <span class="ot">&lt;-</span> <span class="cf">function</span>(panels, layout, x_scales, y_scales, ranges, coord, data,</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>                   theme, params) {</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>  <span class="co"># Place panels according to settings</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a>  <span class="cf">if</span> (params<span class="sc">$</span>horizontal) {</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a>    <span class="co"># Put panels in matrix and convert to a gtable</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a>    panels <span class="ot">&lt;-</span> <span class="fu">matrix</span>(panels, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_matrix</span>(<span class="st">&quot;layout&quot;</span>, panels, </span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a>      <span class="at">widths =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;null&quot;</span>), <span class="at">heights =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;null&quot;</span>), <span class="at">clip =</span> <span class="st">&quot;on&quot;</span>)</span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a>    <span class="co"># Add spacing according to theme</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a>    panel_spacing <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(theme<span class="sc">$</span>panel.spacing.x)) {</span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a>      theme<span class="sc">$</span>panel.spacing</span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a>      theme<span class="sc">$</span>panel.spacing.x</span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a>    }</span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_col_space</span>(panel_table, panel_spacing)</span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a>    panels <span class="ot">&lt;-</span> <span class="fu">matrix</span>(panels, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_matrix</span>(<span class="st">&quot;layout&quot;</span>, panels, </span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a>      <span class="at">widths =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;null&quot;</span>), <span class="at">heights =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;null&quot;</span>), <span class="at">clip =</span> <span class="st">&quot;on&quot;</span>)</span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a>    panel_spacing <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(theme<span class="sc">$</span>panel.spacing.y)) {</span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a>      theme<span class="sc">$</span>panel.spacing</span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a>      theme<span class="sc">$</span>panel.spacing.y</span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a>    }</span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_row_space</span>(panel_table, panel_spacing)</span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a>  }</span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a>  <span class="co"># Name panel grobs so they can be found later</span></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a>  panel_table<span class="sc">$</span>layout<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;panel-&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a>  </span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a>  <span class="co"># Construct the axes</span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a>  axes <span class="ot">&lt;-</span> <span class="fu">render_axes</span>(ranges[<span class="dv">1</span>], ranges[<span class="dv">1</span>], coord, theme, </span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a>    <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a></span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a>  <span class="co"># Add axes around each panel</span></span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a>  panel_pos_h <span class="ot">&lt;-</span> <span class="fu">panel_cols</span>(panel_table)<span class="sc">$</span>l</span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a>  panel_pos_v <span class="ot">&lt;-</span> <span class="fu">panel_rows</span>(panel_table)<span class="sc">$</span>t</span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a>  axis_width_l <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertWidth</span>(</span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">grobWidth</span>(axes<span class="sc">$</span>y<span class="sc">$</span>left[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a>  axis_width_r <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertWidth</span>(</span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">grobWidth</span>(axes<span class="sc">$</span>y<span class="sc">$</span>right[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a>  <span class="do">## We do it reverse so we don&#39;t change the position of panels when we add axes</span></span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rev</span>(panel_pos_h)) {</span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(panel_table, axis_width_r, i)</span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, </span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a>      <span class="fu">rep</span>(axes<span class="sc">$</span>y<span class="sc">$</span>right, <span class="fu">length</span>(panel_pos_v)), <span class="at">t =</span> panel_pos_v, <span class="at">l =</span> i <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a>      <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(panel_table, axis_width_l, i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, </span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a>      <span class="fu">rep</span>(axes<span class="sc">$</span>y<span class="sc">$</span>left, <span class="fu">length</span>(panel_pos_v)), <span class="at">t =</span> panel_pos_v, <span class="at">l =</span> i, </span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a>      <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a>  }</span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a>  <span class="do">## Recalculate as gtable has changed</span></span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a>  panel_pos_h <span class="ot">&lt;-</span> <span class="fu">panel_cols</span>(panel_table)<span class="sc">$</span>l</span>
<span id="cb30-54"><a href="#cb30-54" tabindex="-1"></a>  panel_pos_v <span class="ot">&lt;-</span> <span class="fu">panel_rows</span>(panel_table)<span class="sc">$</span>t</span>
<span id="cb30-55"><a href="#cb30-55" tabindex="-1"></a>  axis_height_t <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertHeight</span>(</span>
<span id="cb30-56"><a href="#cb30-56" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">grobHeight</span>(axes<span class="sc">$</span>x<span class="sc">$</span>top[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb30-57"><a href="#cb30-57" tabindex="-1"></a>  axis_height_b <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertHeight</span>(</span>
<span id="cb30-58"><a href="#cb30-58" tabindex="-1"></a>    grid<span class="sc">::</span><span class="fu">grobHeight</span>(axes<span class="sc">$</span>x<span class="sc">$</span>bottom[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb30-59"><a href="#cb30-59" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rev</span>(panel_pos_v)) {</span>
<span id="cb30-60"><a href="#cb30-60" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_rows</span>(panel_table, axis_height_b, i)</span>
<span id="cb30-61"><a href="#cb30-61" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, </span>
<span id="cb30-62"><a href="#cb30-62" tabindex="-1"></a>      <span class="fu">rep</span>(axes<span class="sc">$</span>x<span class="sc">$</span>bottom, <span class="fu">length</span>(panel_pos_h)), <span class="at">t =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">l =</span> panel_pos_h, </span>
<span id="cb30-63"><a href="#cb30-63" tabindex="-1"></a>      <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb30-64"><a href="#cb30-64" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_rows</span>(panel_table, axis_height_t, i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb30-65"><a href="#cb30-65" tabindex="-1"></a>    panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, </span>
<span id="cb30-66"><a href="#cb30-66" tabindex="-1"></a>      <span class="fu">rep</span>(axes<span class="sc">$</span>x<span class="sc">$</span>top, <span class="fu">length</span>(panel_pos_h)), <span class="at">t =</span> i, <span class="at">l =</span> panel_pos_h, </span>
<span id="cb30-67"><a href="#cb30-67" tabindex="-1"></a>      <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb30-68"><a href="#cb30-68" tabindex="-1"></a>  }</span>
<span id="cb30-69"><a href="#cb30-69" tabindex="-1"></a>  panel_table</span>
<span id="cb30-70"><a href="#cb30-70" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="assembling-the-facet-class" class="section level3">
<h3>Assembling the Facet class</h3>
<p>Usually all methods are defined within the class definition in the
same way as is done for <code>Geom</code> and <code>Stat</code>. Here we
have split it out so we could go through each in turn. All that remains
is to assign our functions to the correct methods as well as making a
constructor</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co"># Constructor: shrink is required to govern whether scales are trained on </span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co"># Stat-transformed data or not.</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>facet_duplicate <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">horizontal =</span> <span class="cn">TRUE</span>, <span class="at">shrink =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">ggproto</span>(<span class="cn">NULL</span>, FacetDuplicate,</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>    <span class="at">shrink =</span> shrink,</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(</span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>      <span class="at">horizontal =</span> horizontal</span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    )</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>  )</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>}</span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a>FacetDuplicate <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;FacetDuplicate&quot;</span>, Facet,</span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>  <span class="at">compute_layout =</span> layout,</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>  <span class="at">map_data =</span> mapping,</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>  <span class="at">draw_panels =</span> render</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>)</span></code></pre></div>
<p>Now with everything assembled, lets test it out:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot showing horsepower against miles per gallon for 32 cars." style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>p <span class="sc">+</span> <span class="fu">facet_duplicate</span>()</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot with two panels showing horsepower against miles per gallon for 32 cars. The left and right panels are identical." style="display: block; margin: auto;" /></p>
</div>
<div id="doing-more-with-facets" class="section level3">
<h3>Doing more with facets</h3>
<p>The example above was pretty useless and we’ll now try to expand on
it to add some actual usability. We are going to make a faceting that
adds panels with y-transformed axes:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>facet_trans <span class="ot">&lt;-</span> <span class="cf">function</span>(trans, <span class="at">horizontal =</span> <span class="cn">TRUE</span>, <span class="at">shrink =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="fu">ggproto</span>(<span class="cn">NULL</span>, FacetTrans,</span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a>    <span class="at">shrink =</span> shrink,</span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>    <span class="at">params =</span> <span class="fu">list</span>(</span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>      <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">as.trans</span>(trans),</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a>      <span class="at">horizontal =</span> horizontal</span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a>    )</span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a>  )</span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a>}</span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a>FacetTrans <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;FacetTrans&quot;</span>, Facet,</span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a>  <span class="co"># Almost as before but we want different y-scales for each panel</span></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a>  <span class="at">compute_layout =</span> <span class="cf">function</span>(data, params) {</span>
<span id="cb34-16"><a href="#cb34-16" tabindex="-1"></a>    <span class="fu">data.frame</span>(<span class="at">PANEL =</span> <span class="fu">c</span>(1L, 2L), <span class="at">SCALE_X =</span> 1L, <span class="at">SCALE_Y =</span> <span class="fu">c</span>(1L, 2L))</span>
<span id="cb34-17"><a href="#cb34-17" tabindex="-1"></a>  },</span>
<span id="cb34-18"><a href="#cb34-18" tabindex="-1"></a>  <span class="co"># Same as before</span></span>
<span id="cb34-19"><a href="#cb34-19" tabindex="-1"></a>  <span class="at">map_data =</span> <span class="cf">function</span>(data, layout, params) {</span>
<span id="cb34-20"><a href="#cb34-20" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(data) <span class="sc">||</span> <span class="fu">nrow</span>(data) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb34-21"><a href="#cb34-21" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(data, <span class="at">PANEL =</span> <span class="fu">integer</span>(<span class="dv">0</span>)))</span>
<span id="cb34-22"><a href="#cb34-22" tabindex="-1"></a>    }</span>
<span id="cb34-23"><a href="#cb34-23" tabindex="-1"></a>    <span class="fu">rbind</span>(</span>
<span id="cb34-24"><a href="#cb34-24" tabindex="-1"></a>      <span class="fu">cbind</span>(data, <span class="at">PANEL =</span> 1L),</span>
<span id="cb34-25"><a href="#cb34-25" tabindex="-1"></a>      <span class="fu">cbind</span>(data, <span class="at">PANEL =</span> 2L)</span>
<span id="cb34-26"><a href="#cb34-26" tabindex="-1"></a>    )</span>
<span id="cb34-27"><a href="#cb34-27" tabindex="-1"></a>  },</span>
<span id="cb34-28"><a href="#cb34-28" tabindex="-1"></a>  <span class="co"># This is new. We create a new scale with the defined transformation</span></span>
<span id="cb34-29"><a href="#cb34-29" tabindex="-1"></a>  <span class="at">init_scales =</span> <span class="cf">function</span>(layout, <span class="at">x_scale =</span> <span class="cn">NULL</span>, <span class="at">y_scale =</span> <span class="cn">NULL</span>, params) {</span>
<span id="cb34-30"><a href="#cb34-30" tabindex="-1"></a>    scales <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb34-31"><a href="#cb34-31" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(x_scale)) {</span>
<span id="cb34-32"><a href="#cb34-32" tabindex="-1"></a>      scales<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(<span class="fu">max</span>(layout<span class="sc">$</span>SCALE_X)), <span class="cf">function</span>(i) x_scale<span class="sc">$</span><span class="fu">clone</span>())</span>
<span id="cb34-33"><a href="#cb34-33" tabindex="-1"></a>    }</span>
<span id="cb34-34"><a href="#cb34-34" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(y_scale)) {</span>
<span id="cb34-35"><a href="#cb34-35" tabindex="-1"></a>      y_scale_orig <span class="ot">&lt;-</span> y_scale<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb34-36"><a href="#cb34-36" tabindex="-1"></a>      y_scale_new <span class="ot">&lt;-</span> y_scale<span class="sc">$</span><span class="fu">clone</span>()</span>
<span id="cb34-37"><a href="#cb34-37" tabindex="-1"></a>      y_scale_new<span class="sc">$</span>trans <span class="ot">&lt;-</span> params<span class="sc">$</span>trans</span>
<span id="cb34-38"><a href="#cb34-38" tabindex="-1"></a>      <span class="co"># Make sure that oob values are kept</span></span>
<span id="cb34-39"><a href="#cb34-39" tabindex="-1"></a>      y_scale_new<span class="sc">$</span>oob <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) x</span>
<span id="cb34-40"><a href="#cb34-40" tabindex="-1"></a>      scales<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">list</span>(y_scale_orig, y_scale_new)</span>
<span id="cb34-41"><a href="#cb34-41" tabindex="-1"></a>    }</span>
<span id="cb34-42"><a href="#cb34-42" tabindex="-1"></a>    scales</span>
<span id="cb34-43"><a href="#cb34-43" tabindex="-1"></a>  },</span>
<span id="cb34-44"><a href="#cb34-44" tabindex="-1"></a>  <span class="co"># We must make sure that the second scale is trained on transformed data</span></span>
<span id="cb34-45"><a href="#cb34-45" tabindex="-1"></a>  <span class="at">train_scales =</span> <span class="cf">function</span>(x_scales, y_scales, layout, data, params) {</span>
<span id="cb34-46"><a href="#cb34-46" tabindex="-1"></a>    <span class="co"># Transform data for second panel prior to scale training</span></span>
<span id="cb34-47"><a href="#cb34-47" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(y_scales)) {</span>
<span id="cb34-48"><a href="#cb34-48" tabindex="-1"></a>      data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data, <span class="cf">function</span>(layer_data) {</span>
<span id="cb34-49"><a href="#cb34-49" tabindex="-1"></a>        match_id <span class="ot">&lt;-</span> <span class="fu">match</span>(layer_data<span class="sc">$</span>PANEL, layout<span class="sc">$</span>PANEL)</span>
<span id="cb34-50"><a href="#cb34-50" tabindex="-1"></a>        y_vars <span class="ot">&lt;-</span> <span class="fu">intersect</span>(y_scales[[<span class="dv">1</span>]]<span class="sc">$</span>aesthetics, <span class="fu">names</span>(layer_data))</span>
<span id="cb34-51"><a href="#cb34-51" tabindex="-1"></a>        trans_scale <span class="ot">&lt;-</span> layer_data<span class="sc">$</span>PANEL <span class="sc">==</span> 2L</span>
<span id="cb34-52"><a href="#cb34-52" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> y_vars) {</span>
<span id="cb34-53"><a href="#cb34-53" tabindex="-1"></a>          layer_data[trans_scale, i] <span class="ot">&lt;-</span> y_scales[[<span class="dv">2</span>]]<span class="sc">$</span><span class="fu">transform</span>(layer_data[trans_scale, i])</span>
<span id="cb34-54"><a href="#cb34-54" tabindex="-1"></a>        }</span>
<span id="cb34-55"><a href="#cb34-55" tabindex="-1"></a>        layer_data</span>
<span id="cb34-56"><a href="#cb34-56" tabindex="-1"></a>      })</span>
<span id="cb34-57"><a href="#cb34-57" tabindex="-1"></a>    }</span>
<span id="cb34-58"><a href="#cb34-58" tabindex="-1"></a>    Facet<span class="sc">$</span><span class="fu">train_scales</span>(x_scales, y_scales, layout, data, params)</span>
<span id="cb34-59"><a href="#cb34-59" tabindex="-1"></a>  },</span>
<span id="cb34-60"><a href="#cb34-60" tabindex="-1"></a>  <span class="co"># this is where we actually modify the data. It cannot be done in $map_data as that function</span></span>
<span id="cb34-61"><a href="#cb34-61" tabindex="-1"></a>  <span class="co"># doesn&#39;t have access to the scales</span></span>
<span id="cb34-62"><a href="#cb34-62" tabindex="-1"></a>  <span class="at">finish_data =</span> <span class="cf">function</span>(data, layout, x_scales, y_scales, params) {</span>
<span id="cb34-63"><a href="#cb34-63" tabindex="-1"></a>    match_id <span class="ot">&lt;-</span> <span class="fu">match</span>(data<span class="sc">$</span>PANEL, layout<span class="sc">$</span>PANEL)</span>
<span id="cb34-64"><a href="#cb34-64" tabindex="-1"></a>    y_vars <span class="ot">&lt;-</span> <span class="fu">intersect</span>(y_scales[[<span class="dv">1</span>]]<span class="sc">$</span>aesthetics, <span class="fu">names</span>(data))</span>
<span id="cb34-65"><a href="#cb34-65" tabindex="-1"></a>    trans_scale <span class="ot">&lt;-</span> data<span class="sc">$</span>PANEL <span class="sc">==</span> 2L</span>
<span id="cb34-66"><a href="#cb34-66" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> y_vars) {</span>
<span id="cb34-67"><a href="#cb34-67" tabindex="-1"></a>      data[trans_scale, i] <span class="ot">&lt;-</span> y_scales[[<span class="dv">2</span>]]<span class="sc">$</span><span class="fu">transform</span>(data[trans_scale, i])</span>
<span id="cb34-68"><a href="#cb34-68" tabindex="-1"></a>    }</span>
<span id="cb34-69"><a href="#cb34-69" tabindex="-1"></a>    data</span>
<span id="cb34-70"><a href="#cb34-70" tabindex="-1"></a>  },</span>
<span id="cb34-71"><a href="#cb34-71" tabindex="-1"></a>  <span class="co"># A few changes from before to accommodate that axes are now not duplicate of each other</span></span>
<span id="cb34-72"><a href="#cb34-72" tabindex="-1"></a>  <span class="co"># We also add a panel strip to annotate the different panels</span></span>
<span id="cb34-73"><a href="#cb34-73" tabindex="-1"></a>  <span class="at">draw_panels =</span> <span class="cf">function</span>(panels, layout, x_scales, y_scales, ranges, coord,</span>
<span id="cb34-74"><a href="#cb34-74" tabindex="-1"></a>                         data, theme, params) {</span>
<span id="cb34-75"><a href="#cb34-75" tabindex="-1"></a>    <span class="co"># Place panels according to settings</span></span>
<span id="cb34-76"><a href="#cb34-76" tabindex="-1"></a>    <span class="cf">if</span> (params<span class="sc">$</span>horizontal) {</span>
<span id="cb34-77"><a href="#cb34-77" tabindex="-1"></a>      <span class="co"># Put panels in matrix and convert to a gtable</span></span>
<span id="cb34-78"><a href="#cb34-78" tabindex="-1"></a>      panels <span class="ot">&lt;-</span> <span class="fu">matrix</span>(panels, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb34-79"><a href="#cb34-79" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_matrix</span>(<span class="st">&quot;layout&quot;</span>, panels, </span>
<span id="cb34-80"><a href="#cb34-80" tabindex="-1"></a>        <span class="at">widths =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;null&quot;</span>), <span class="at">heights =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;null&quot;</span>), <span class="at">clip =</span> <span class="st">&quot;on&quot;</span>)</span>
<span id="cb34-81"><a href="#cb34-81" tabindex="-1"></a>      <span class="co"># Add spacing according to theme</span></span>
<span id="cb34-82"><a href="#cb34-82" tabindex="-1"></a>      panel_spacing <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(theme<span class="sc">$</span>panel.spacing.x)) {</span>
<span id="cb34-83"><a href="#cb34-83" tabindex="-1"></a>        theme<span class="sc">$</span>panel.spacing</span>
<span id="cb34-84"><a href="#cb34-84" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb34-85"><a href="#cb34-85" tabindex="-1"></a>        theme<span class="sc">$</span>panel.spacing.x</span>
<span id="cb34-86"><a href="#cb34-86" tabindex="-1"></a>      }</span>
<span id="cb34-87"><a href="#cb34-87" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_col_space</span>(panel_table, panel_spacing)</span>
<span id="cb34-88"><a href="#cb34-88" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb34-89"><a href="#cb34-89" tabindex="-1"></a>      panels <span class="ot">&lt;-</span> <span class="fu">matrix</span>(panels, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb34-90"><a href="#cb34-90" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_matrix</span>(<span class="st">&quot;layout&quot;</span>, panels, </span>
<span id="cb34-91"><a href="#cb34-91" tabindex="-1"></a>        <span class="at">widths =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">&quot;null&quot;</span>), <span class="at">heights =</span> <span class="fu">unit</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;null&quot;</span>), <span class="at">clip =</span> <span class="st">&quot;on&quot;</span>)</span>
<span id="cb34-92"><a href="#cb34-92" tabindex="-1"></a>      panel_spacing <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.null</span>(theme<span class="sc">$</span>panel.spacing.y)) {</span>
<span id="cb34-93"><a href="#cb34-93" tabindex="-1"></a>        theme<span class="sc">$</span>panel.spacing</span>
<span id="cb34-94"><a href="#cb34-94" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb34-95"><a href="#cb34-95" tabindex="-1"></a>        theme<span class="sc">$</span>panel.spacing.y</span>
<span id="cb34-96"><a href="#cb34-96" tabindex="-1"></a>      }</span>
<span id="cb34-97"><a href="#cb34-97" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_row_space</span>(panel_table, panel_spacing)</span>
<span id="cb34-98"><a href="#cb34-98" tabindex="-1"></a>    }</span>
<span id="cb34-99"><a href="#cb34-99" tabindex="-1"></a>    <span class="co"># Name panel grobs so they can be found later</span></span>
<span id="cb34-100"><a href="#cb34-100" tabindex="-1"></a>    panel_table<span class="sc">$</span>layout<span class="sc">$</span>name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;panel-&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb34-101"><a href="#cb34-101" tabindex="-1"></a>    </span>
<span id="cb34-102"><a href="#cb34-102" tabindex="-1"></a>    <span class="co"># Construct the axes</span></span>
<span id="cb34-103"><a href="#cb34-103" tabindex="-1"></a>    axes <span class="ot">&lt;-</span> <span class="fu">render_axes</span>(ranges[<span class="dv">1</span>], ranges, coord, theme, </span>
<span id="cb34-104"><a href="#cb34-104" tabindex="-1"></a>      <span class="at">transpose =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-105"><a href="#cb34-105" tabindex="-1"></a>  </span>
<span id="cb34-106"><a href="#cb34-106" tabindex="-1"></a>    <span class="co"># Add axes around each panel</span></span>
<span id="cb34-107"><a href="#cb34-107" tabindex="-1"></a>    grobWidths <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb34-108"><a href="#cb34-108" tabindex="-1"></a>      <span class="fu">unit</span>(<span class="fu">vapply</span>(x, <span class="cf">function</span>(x) {</span>
<span id="cb34-109"><a href="#cb34-109" tabindex="-1"></a>        grid<span class="sc">::</span><span class="fu">convertWidth</span>(</span>
<span id="cb34-110"><a href="#cb34-110" tabindex="-1"></a>          grid<span class="sc">::</span><span class="fu">grobWidth</span>(x), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>)</span>
<span id="cb34-111"><a href="#cb34-111" tabindex="-1"></a>      }, <span class="fu">numeric</span>(<span class="dv">1</span>)), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb34-112"><a href="#cb34-112" tabindex="-1"></a>    }</span>
<span id="cb34-113"><a href="#cb34-113" tabindex="-1"></a>    panel_pos_h <span class="ot">&lt;-</span> <span class="fu">panel_cols</span>(panel_table)<span class="sc">$</span>l</span>
<span id="cb34-114"><a href="#cb34-114" tabindex="-1"></a>    panel_pos_v <span class="ot">&lt;-</span> <span class="fu">panel_rows</span>(panel_table)<span class="sc">$</span>t</span>
<span id="cb34-115"><a href="#cb34-115" tabindex="-1"></a>    axis_width_l <span class="ot">&lt;-</span> <span class="fu">grobWidths</span>(axes<span class="sc">$</span>y<span class="sc">$</span>left)</span>
<span id="cb34-116"><a href="#cb34-116" tabindex="-1"></a>    axis_width_r <span class="ot">&lt;-</span> <span class="fu">grobWidths</span>(axes<span class="sc">$</span>y<span class="sc">$</span>right)</span>
<span id="cb34-117"><a href="#cb34-117" tabindex="-1"></a>    <span class="do">## We do it reverse so we don&#39;t change the position of panels when we add axes</span></span>
<span id="cb34-118"><a href="#cb34-118" tabindex="-1"></a>    <span class="cf">if</span> (params<span class="sc">$</span>horizontal) {</span>
<span id="cb34-119"><a href="#cb34-119" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rev</span>(<span class="fu">seq_along</span>(panel_pos_h))) {</span>
<span id="cb34-120"><a href="#cb34-120" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(panel_table, axis_width_r[i], panel_pos_h[i])</span>
<span id="cb34-121"><a href="#cb34-121" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table,</span>
<span id="cb34-122"><a href="#cb34-122" tabindex="-1"></a>          axes<span class="sc">$</span>y<span class="sc">$</span>right[i], <span class="at">t =</span> panel_pos_v, <span class="at">l =</span> panel_pos_h[i] <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb34-123"><a href="#cb34-123" tabindex="-1"></a>          <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-124"><a href="#cb34-124" tabindex="-1"></a></span>
<span id="cb34-125"><a href="#cb34-125" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(panel_table, axis_width_l[i], panel_pos_h[i] <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb34-126"><a href="#cb34-126" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table,</span>
<span id="cb34-127"><a href="#cb34-127" tabindex="-1"></a>          axes<span class="sc">$</span>y<span class="sc">$</span>left[i], <span class="at">t =</span> panel_pos_v, <span class="at">l =</span> panel_pos_h[i],</span>
<span id="cb34-128"><a href="#cb34-128" tabindex="-1"></a>          <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-129"><a href="#cb34-129" tabindex="-1"></a>      }</span>
<span id="cb34-130"><a href="#cb34-130" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb34-131"><a href="#cb34-131" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(panel_table, axis_width_r[<span class="dv">1</span>], panel_pos_h)</span>
<span id="cb34-132"><a href="#cb34-132" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table,</span>
<span id="cb34-133"><a href="#cb34-133" tabindex="-1"></a>          axes<span class="sc">$</span>y<span class="sc">$</span>right, <span class="at">t =</span> panel_pos_v, <span class="at">l =</span> panel_pos_h <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb34-134"><a href="#cb34-134" tabindex="-1"></a>          <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-135"><a href="#cb34-135" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_cols</span>(panel_table, axis_width_l[<span class="dv">1</span>], panel_pos_h <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb34-136"><a href="#cb34-136" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table,</span>
<span id="cb34-137"><a href="#cb34-137" tabindex="-1"></a>          axes<span class="sc">$</span>y<span class="sc">$</span>left, <span class="at">t =</span> panel_pos_v, <span class="at">l =</span> panel_pos_h,</span>
<span id="cb34-138"><a href="#cb34-138" tabindex="-1"></a>          <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-139"><a href="#cb34-139" tabindex="-1"></a>      }</span>
<span id="cb34-140"><a href="#cb34-140" tabindex="-1"></a></span>
<span id="cb34-141"><a href="#cb34-141" tabindex="-1"></a>    <span class="do">## Recalculate as gtable has changed</span></span>
<span id="cb34-142"><a href="#cb34-142" tabindex="-1"></a>    panel_pos_h <span class="ot">&lt;-</span> <span class="fu">panel_cols</span>(panel_table)<span class="sc">$</span>l</span>
<span id="cb34-143"><a href="#cb34-143" tabindex="-1"></a>    panel_pos_v <span class="ot">&lt;-</span> <span class="fu">panel_rows</span>(panel_table)<span class="sc">$</span>t</span>
<span id="cb34-144"><a href="#cb34-144" tabindex="-1"></a>    axis_height_t <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertHeight</span>(</span>
<span id="cb34-145"><a href="#cb34-145" tabindex="-1"></a>      grid<span class="sc">::</span><span class="fu">grobHeight</span>(axes<span class="sc">$</span>x<span class="sc">$</span>top[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb34-146"><a href="#cb34-146" tabindex="-1"></a>    axis_height_b <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertHeight</span>(</span>
<span id="cb34-147"><a href="#cb34-147" tabindex="-1"></a>      grid<span class="sc">::</span><span class="fu">grobHeight</span>(axes<span class="sc">$</span>x<span class="sc">$</span>bottom[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb34-148"><a href="#cb34-148" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rev</span>(panel_pos_v)) {</span>
<span id="cb34-149"><a href="#cb34-149" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_rows</span>(panel_table, axis_height_b, i)</span>
<span id="cb34-150"><a href="#cb34-150" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, </span>
<span id="cb34-151"><a href="#cb34-151" tabindex="-1"></a>        <span class="fu">rep</span>(axes<span class="sc">$</span>x<span class="sc">$</span>bottom, <span class="fu">length</span>(panel_pos_h)), <span class="at">t =</span> i <span class="sc">+</span> <span class="dv">1</span>, <span class="at">l =</span> panel_pos_h, </span>
<span id="cb34-152"><a href="#cb34-152" tabindex="-1"></a>        <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-153"><a href="#cb34-153" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_rows</span>(panel_table, axis_height_t, i <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb34-154"><a href="#cb34-154" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, </span>
<span id="cb34-155"><a href="#cb34-155" tabindex="-1"></a>        <span class="fu">rep</span>(axes<span class="sc">$</span>x<span class="sc">$</span>top, <span class="fu">length</span>(panel_pos_h)), <span class="at">t =</span> i, <span class="at">l =</span> panel_pos_h, </span>
<span id="cb34-156"><a href="#cb34-156" tabindex="-1"></a>        <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-157"><a href="#cb34-157" tabindex="-1"></a>    }</span>
<span id="cb34-158"><a href="#cb34-158" tabindex="-1"></a>    </span>
<span id="cb34-159"><a href="#cb34-159" tabindex="-1"></a>    <span class="co"># Add strips</span></span>
<span id="cb34-160"><a href="#cb34-160" tabindex="-1"></a>    strips <span class="ot">&lt;-</span> <span class="fu">render_strips</span>(</span>
<span id="cb34-161"><a href="#cb34-161" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;Original&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;Transformed (&quot;</span>, params<span class="sc">$</span>trans<span class="sc">$</span>name, <span class="st">&quot;)&quot;</span>))),</span>
<span id="cb34-162"><a href="#cb34-162" tabindex="-1"></a>      <span class="at">labeller =</span> label_value, <span class="at">theme =</span> theme)</span>
<span id="cb34-163"><a href="#cb34-163" tabindex="-1"></a>    </span>
<span id="cb34-164"><a href="#cb34-164" tabindex="-1"></a>    panel_pos_h <span class="ot">&lt;-</span> <span class="fu">panel_cols</span>(panel_table)<span class="sc">$</span>l</span>
<span id="cb34-165"><a href="#cb34-165" tabindex="-1"></a>    panel_pos_v <span class="ot">&lt;-</span> <span class="fu">panel_rows</span>(panel_table)<span class="sc">$</span>t</span>
<span id="cb34-166"><a href="#cb34-166" tabindex="-1"></a>    strip_height <span class="ot">&lt;-</span> <span class="fu">unit</span>(grid<span class="sc">::</span><span class="fu">convertHeight</span>(</span>
<span id="cb34-167"><a href="#cb34-167" tabindex="-1"></a>      grid<span class="sc">::</span><span class="fu">grobHeight</span>(strips<span class="sc">$</span>x<span class="sc">$</span>top[[<span class="dv">1</span>]]), <span class="st">&quot;cm&quot;</span>, <span class="cn">TRUE</span>), <span class="st">&quot;cm&quot;</span>)</span>
<span id="cb34-168"><a href="#cb34-168" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">rev</span>(<span class="fu">seq_along</span>(panel_pos_v))) {</span>
<span id="cb34-169"><a href="#cb34-169" tabindex="-1"></a>      panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_rows</span>(panel_table, strip_height, panel_pos_v[i] <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb34-170"><a href="#cb34-170" tabindex="-1"></a>      <span class="cf">if</span> (params<span class="sc">$</span>horizontal) {</span>
<span id="cb34-171"><a href="#cb34-171" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, strips<span class="sc">$</span>x<span class="sc">$</span>top, </span>
<span id="cb34-172"><a href="#cb34-172" tabindex="-1"></a>          <span class="at">t =</span> panel_pos_v[i], <span class="at">l =</span> panel_pos_h, <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-173"><a href="#cb34-173" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb34-174"><a href="#cb34-174" tabindex="-1"></a>        panel_table <span class="ot">&lt;-</span> gtable<span class="sc">::</span><span class="fu">gtable_add_grob</span>(panel_table, strips<span class="sc">$</span>x<span class="sc">$</span>top[i], </span>
<span id="cb34-175"><a href="#cb34-175" tabindex="-1"></a>          <span class="at">t =</span> panel_pos_v[i], <span class="at">l =</span> panel_pos_h, <span class="at">clip =</span> <span class="st">&quot;off&quot;</span>)</span>
<span id="cb34-176"><a href="#cb34-176" tabindex="-1"></a>      }</span>
<span id="cb34-177"><a href="#cb34-177" tabindex="-1"></a>    }</span>
<span id="cb34-178"><a href="#cb34-178" tabindex="-1"></a>    </span>
<span id="cb34-179"><a href="#cb34-179" tabindex="-1"></a>    </span>
<span id="cb34-180"><a href="#cb34-180" tabindex="-1"></a>    panel_table</span>
<span id="cb34-181"><a href="#cb34-181" tabindex="-1"></a>  }</span>
<span id="cb34-182"><a href="#cb34-182" tabindex="-1"></a>)</span></code></pre></div>
<p>As is very apparent, the <code>draw_panel</code> method can become
very unwieldy once it begins to take multiple possibilities into
account. The fact that we want to support both horizontal and vertical
layout leads to a lot of if/else blocks in the above code. In general,
this is the big challenge when writing facet extensions so be prepared
to be very meticulous when writing these methods.</p>
<p>Enough talk - lets see if our new and powerful faceting extension
works:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> hp, <span class="at">y =</span> mpg)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_trans</span>(<span class="st">&#39;sqrt&#39;</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot with two panels showing horsepower against miles per gallon for 32 cars. Both panels show the same datapoints. The left panel is titled &#39;original&#39; and the right panel is titled &#39;transformed (sqrt)&#39;. On the right panel, the miles per gallon are displayed on a square root transformed scale." style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="extending-existing-facet-function" class="section level2">
<h2>Extending existing facet function</h2>
<p>As the rendering part of a facet class is often the difficult
development step, it is possible to piggyback on the existing faceting
classes to achieve a range of new facetings. Below we will subclass
<code>facet_wrap()</code> to make a <code>facet_bootstrap()</code> class
that splits the input data into a number of panels at random.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>facet_bootstrap <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">9</span>, <span class="at">prop =</span> <span class="fl">0.2</span>, <span class="at">nrow =</span> <span class="cn">NULL</span>, <span class="at">ncol =</span> <span class="cn">NULL</span>, </span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>  <span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>, <span class="at">shrink =</span> <span class="cn">TRUE</span>, <span class="at">strip.position =</span> <span class="st">&quot;top&quot;</span>) {</span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  </span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>  facet <span class="ot">&lt;-</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>.bootstrap, <span class="at">nrow =</span> nrow, <span class="at">ncol =</span> ncol, <span class="at">scales =</span> scales, </span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a>    <span class="at">shrink =</span> shrink, <span class="at">strip.position =</span> strip.position)</span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a>  facet<span class="sc">$</span>params<span class="sc">$</span>n <span class="ot">&lt;-</span> n</span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a>  facet<span class="sc">$</span>params<span class="sc">$</span>prop <span class="ot">&lt;-</span> prop</span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a>  <span class="fu">ggproto</span>(<span class="cn">NULL</span>, FacetBootstrap,</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a>    <span class="at">shrink =</span> shrink,</span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a>    <span class="at">params =</span> facet<span class="sc">$</span>params</span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a>  )</span>
<span id="cb36-12"><a href="#cb36-12" tabindex="-1"></a>}</span>
<span id="cb36-13"><a href="#cb36-13" tabindex="-1"></a></span>
<span id="cb36-14"><a href="#cb36-14" tabindex="-1"></a>FacetBootstrap <span class="ot">&lt;-</span> <span class="fu">ggproto</span>(<span class="st">&quot;FacetBootstrap&quot;</span>, FacetWrap,</span>
<span id="cb36-15"><a href="#cb36-15" tabindex="-1"></a>  <span class="at">compute_layout =</span> <span class="cf">function</span>(data, params) {</span>
<span id="cb36-16"><a href="#cb36-16" tabindex="-1"></a>    id <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(params<span class="sc">$</span>n)</span>
<span id="cb36-17"><a href="#cb36-17" tabindex="-1"></a></span>
<span id="cb36-18"><a href="#cb36-18" tabindex="-1"></a>    dims <span class="ot">&lt;-</span> <span class="fu">wrap_dims</span>(params<span class="sc">$</span>n, params<span class="sc">$</span>nrow, params<span class="sc">$</span>ncol)</span>
<span id="cb36-19"><a href="#cb36-19" tabindex="-1"></a>    layout <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PANEL =</span> <span class="fu">factor</span>(id))</span>
<span id="cb36-20"><a href="#cb36-20" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" tabindex="-1"></a>    <span class="cf">if</span> (params<span class="sc">$</span>as.table) {</span>
<span id="cb36-22"><a href="#cb36-22" tabindex="-1"></a>      layout<span class="sc">$</span>ROW <span class="ot">&lt;-</span> <span class="fu">as.integer</span>((id <span class="sc">-</span> 1L) <span class="sc">%/%</span> dims[<span class="dv">2</span>] <span class="sc">+</span> 1L)</span>
<span id="cb36-23"><a href="#cb36-23" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb36-24"><a href="#cb36-24" tabindex="-1"></a>      layout<span class="sc">$</span>ROW <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(dims[<span class="dv">1</span>] <span class="sc">-</span> (id <span class="sc">-</span> 1L) <span class="sc">%/%</span> dims[<span class="dv">2</span>])</span>
<span id="cb36-25"><a href="#cb36-25" tabindex="-1"></a>    }</span>
<span id="cb36-26"><a href="#cb36-26" tabindex="-1"></a>    layout<span class="sc">$</span>COL <span class="ot">&lt;-</span> <span class="fu">as.integer</span>((id <span class="sc">-</span> 1L) <span class="sc">%%</span> dims[<span class="dv">2</span>] <span class="sc">+</span> 1L)</span>
<span id="cb36-27"><a href="#cb36-27" tabindex="-1"></a></span>
<span id="cb36-28"><a href="#cb36-28" tabindex="-1"></a>    layout <span class="ot">&lt;-</span> layout[<span class="fu">order</span>(layout<span class="sc">$</span>PANEL), , drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb36-29"><a href="#cb36-29" tabindex="-1"></a>    <span class="fu">rownames</span>(layout) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb36-30"><a href="#cb36-30" tabindex="-1"></a></span>
<span id="cb36-31"><a href="#cb36-31" tabindex="-1"></a>    <span class="co"># Add scale identification</span></span>
<span id="cb36-32"><a href="#cb36-32" tabindex="-1"></a>    layout<span class="sc">$</span>SCALE_X <span class="ot">&lt;-</span> <span class="cf">if</span> (params<span class="sc">$</span>free<span class="sc">$</span>x) id <span class="cf">else</span> 1L</span>
<span id="cb36-33"><a href="#cb36-33" tabindex="-1"></a>    layout<span class="sc">$</span>SCALE_Y <span class="ot">&lt;-</span> <span class="cf">if</span> (params<span class="sc">$</span>free<span class="sc">$</span>y) id <span class="cf">else</span> 1L</span>
<span id="cb36-34"><a href="#cb36-34" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" tabindex="-1"></a>    <span class="fu">cbind</span>(layout, <span class="at">.bootstrap =</span> id)</span>
<span id="cb36-36"><a href="#cb36-36" tabindex="-1"></a>  },</span>
<span id="cb36-37"><a href="#cb36-37" tabindex="-1"></a>  <span class="at">map_data =</span> <span class="cf">function</span>(data, layout, params) {</span>
<span id="cb36-38"><a href="#cb36-38" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(data) <span class="sc">||</span> <span class="fu">nrow</span>(data) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb36-39"><a href="#cb36-39" tabindex="-1"></a>      <span class="fu">return</span>(<span class="fu">cbind</span>(data, <span class="at">PANEL =</span> <span class="fu">integer</span>(<span class="dv">0</span>)))</span>
<span id="cb36-40"><a href="#cb36-40" tabindex="-1"></a>    }</span>
<span id="cb36-41"><a href="#cb36-41" tabindex="-1"></a>    n_samples <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">nrow</span>(data) <span class="sc">*</span> params<span class="sc">$</span>prop)</span>
<span id="cb36-42"><a href="#cb36-42" tabindex="-1"></a>    new_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">seq_len</span>(params<span class="sc">$</span>n), <span class="cf">function</span>(i) {</span>
<span id="cb36-43"><a href="#cb36-43" tabindex="-1"></a>      <span class="fu">cbind</span>(data[<span class="fu">sample</span>(<span class="fu">nrow</span>(data), n_samples), , <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">PANEL =</span> i)</span>
<span id="cb36-44"><a href="#cb36-44" tabindex="-1"></a>    })</span>
<span id="cb36-45"><a href="#cb36-45" tabindex="-1"></a>    <span class="fu">do.call</span>(rbind, new_data)</span>
<span id="cb36-46"><a href="#cb36-46" tabindex="-1"></a>  }</span>
<span id="cb36-47"><a href="#cb36-47" tabindex="-1"></a>)</span>
<span id="cb36-48"><a href="#cb36-48" tabindex="-1"></a></span>
<span id="cb36-49"><a href="#cb36-49" tabindex="-1"></a><span class="fu">ggplot</span>(diamonds, <span class="fu">aes</span>(carat, price)) <span class="sc">+</span> </span>
<span id="cb36-50"><a href="#cb36-50" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.1</span>) <span class="sc">+</span> </span>
<span id="cb36-51"><a href="#cb36-51" tabindex="-1"></a>  <span class="fu">facet_bootstrap</span>(<span class="at">n =</span> <span class="dv">9</span>, <span class="at">prop =</span> <span class="fl">0.05</span>)</span></code></pre></div>
<p><img src="data:image/png;base64,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" alt="Scatterplot with three-by-three panels showing the weight versus the price of about 10.000 diamonds in every panel. The panels are titled 1 to 9 and show different points, but are visually similar." style="display: block; margin: auto;" /></p>
<p>What we are doing above is to intercept the
<code>compute_layout</code> and <code>map_data</code> methods and
instead of dividing the data by a variable we randomly assigns rows to a
panel based on the sampling parameters (<code>n</code> determines the
number of panels, <code>prop</code> determines the proportion of data in
each panel). It is important here that the layout returned by
<code>compute_layout</code> is a valid layout for <code>FacetWrap</code>
as we are counting on the <code>draw_panel</code> method from
<code>FacetWrap</code> to do all the work for us. Thus if you want to
subclass FacetWrap or FacetGrid, make sure you understand the nature of
their layout specification.</p>
<div id="exercises-2" class="section level3">
<h3>Exercises</h3>
<ol style="list-style-type: decimal">
<li>Rewrite FacetTrans to take a vector of transformations and create an
additional panel for each transformation.</li>
<li>Based on the FacetWrap implementation rewrite FacetTrans to take the
strip.placement theme setting into account.</li>
<li>Think about which caveats there are in FacetBootstrap specifically
related to adding multiple layers with the same data.</li>
</ol>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
